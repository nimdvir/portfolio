!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){t.exports=i(1)},function(module,exports){!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=8)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),o=function(){function t(){}return t.getTagData=function(){var t;try{(null===(t=document.currentScript)||void 0===t?void 0:t.getAttribute("data-siteKey"))&&(null===t||void 0===t?void 0:t.getAttribute("data-pubKey"))||(t=document.getElementById("browsi-tag"))}catch(e){t=document.getElementById("browsi-tag")}if(!t)throw new Error("no tag");var e=this.getSessionStorage("__browsienv")||t.getAttribute("data-browsidomain")||".browsiprod.com",i="";try{var n=t.getAttribute("src")||"";i=new URL(n).host}catch(t){i="NA"}return{tag:t,sk:t.getAttribute("data-siteKey")||"error",pk:t.getAttribute("data-pubKey")||"error",ds:e,y:"yield-manager"+e,es:"//events"+e+"/events/",fp:t.hasAttribute("prebidbpt"),mt:t.hasAttribute("master"),pd:t.prebidData,so:i}},t.getSessionStorage=function(t){var e;try{e=sessionStorage.getItem(t)}catch(t){}return e||""},t.setSessionStorage=function(t,e){sessionStorage[t]="string"==typeof e?e:JSON.stringify(e)},t.getBIAgentDebugConfig=function(){var t=this.getSessionStorage("__brwsibad"),e={};return t&&(e=JSON.parse(t)),e},t.getD=function(){var t=this.getSessionStorage("__brwsidbg"),e={};return t&&(e=JSON.parse(t)),e},t.isD=function(){var e=t.getD();return!!(null===e||void 0===e?void 0:e.hasOwnProperty("debug"))},t.getLiveConfig=function(){var t=this.getSessionStorage("__brwsilc"),e={};return t&&(e=JSON.parse(t)),e},t.isLiveConfigExtensionEnabled=function(){return!!n.Context.window.__brw_lc},t.isTestMode=function(){var e=t.getD();return!(!e||!e.hasOwnProperty("test"))},t.isObject=function(t){return t&&"object"==typeof t&&!Array.isArray(t)},t.mergeDeep=function(t,e){var i,n;if(this.isObject(t)&&this.isObject(e))for(var o in e)e.hasOwnProperty(o)&&this.isObject(e[o])?(t[o]||Object.assign(t,((i={})[o]={},i)),this.mergeDeep(t[o],e[o])):Object.assign(t,((n={})[o]=e[o],n));return t},t.generateToken=function(){var t="abcdefghijklmnopqrstuvwxyz";t+=t.toUpperCase()+"_!@#$";for(var e="",i=0;i<20;i++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},t.getCookie=function(t){var e=n.Context.document.cookie.split(/\s*;\s*/).map(function(t){var e=t.split(/\s*=\s*/);if(2===(null===e||void 0===e?void 0:e.length))return{key:e[0],value:e[1]}}).find(function(e){return(null===e||void 0===e?void 0:e.key)===t});return e?e.value:""},t.setCookie=function(t,e,i,o){void 0===e&&(e=""),void 0===i&&(i=0),void 0===o&&(o="d");var r=6e4;"d"===o&&(r*=1440);var a=new Date(+new Date+i*r);n.Context.document.cookie=t+"="+e+"; expires="+a.toUTCString()+"; path=/"},t.setLocalStorage=function(t,e){try{localStorage.setItem(t,e)}catch(t){}},t.getLocalStorage=function(t){try{return n.Context.windowType.localStorage.getItem(t)||""}catch(t){}return""},t.toUrlParams=function(t){return Object.keys(t).map(function(e){return e+"="+("object"==typeof t[e]?encodeURIComponent(JSON.stringify(t[e])):encodeURIComponent(t[e]))}).join("&")},t.getHead=function(t){return t.head||t.getElementsByTagName("head")[0]},t.getResolution=function(){return n.Context.windowType.screen.width+"x"+n.Context.windowType.screen.height},t.isPositionContained=function(t,e){return!!(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)},t.isVisible=function(t){return this.isCssVisible(t)&&this.hasValidSize(t)},t.isCssVisible=function(t){var e=n.Context.windowType.getComputedStyle(t);return!!e&&("visible"===e.getPropertyValue("visibility")&&"none"!==e.getPropertyValue("display")&&"0"!==e.getPropertyValue("opacity"))},t.hasValidSize=function(t){var e=t.getBoundingClientRect();return e.height>0&&e.width>0},t.getUrlParams=function(){var t=n.Context.document.location.search.substring(1);if(0===t.length)return{};var e={};return t.split("&").forEach(function(t){var i=t.split("=");2===i.length&&i[0]&&(e[i[0]]=i[1])}),e},t.xhrPromise=function(t){return new Promise(function(e,i){var n=new XMLHttpRequest;n.open("GET",t,!0),n.onreadystatechange=function(){n.readyState==(n.DONE||4)&&(200===n.status||204===n.status?e(n):i(n.status))},n.send()})},t.isPromise=function(t){return t instanceof Promise},t.dispatchDOMEvent=function(t,e,i){var n=new CustomEvent(t,{detail:e});i.dispatchEvent(n)},t.generateUUIDIfSupported=function(){return window.crypto&&window.crypto.randomUUID&&window.crypto.randomUUID()||""},t.getStoredPvid=function(){try{return n.Context.window.browsitag.pvid}catch(t){return}},t.setStoredPvid=function(t){try{n.Context.window.browsitag.pvid=t}catch(t){}},t.getStoredBpvid=function(){try{return n.Context.window.browsitag.bpvid}catch(t){}},t.setStoredBpvid=function(t){try{n.Context.window.browsitag.bpvid=t}catch(t){}},t.setIsBptLoaded=function(t){try{n.Context.window.browsitag.ibl=t}catch(t){}},t.getIsBptLoaded=function(){try{return!!n.Context.window.browsitag.ibl}catch(t){}},t.onReInject=function(){t.setStoredPvid(""),t.setStoredBpvid(""),t.setIsBptLoaded(!1),n.Context.window._middyo=null,n.Context.window.browsitag.st=null,n.Context.window.browsitag.__ori=null,n.Context.window.browsitag.mt.ex=null},t.getMetaDataLanguage=function(){var t;return(null===(t=n.Context.document.querySelector('meta[property="og:locale"]'))||void 0===t?void 0:t.content)||n.Context.document.documentElement.lang},t.isEngagingUser=function(){var t,e;return(window.scrollY||("CSS1Compat"===document.compatMode?null===(t=document.documentElement)||void 0===t?void 0:t.scrollTop:null===(e=document.body)||void 0===e?void 0:e.scrollTop))>0},t.getDaysDifference=function(e,i){return Math.abs(e-i)/t.millisecondsPerDay},t.getTimestamp=function(){return Date.now()},t.isObjectDefined=function(t){return!(!t||"object"!=typeof t||!Object.keys(t).length)},t.millisecondsPerDay=864e5,t}();e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Context=void 0;var n=function(){function t(){}return Object.defineProperty(t,"windowType",{get:function(){return this._window||(this._window=window.top),this._window},enumerable:!1,configurable:!0}),Object.defineProperty(t,"window",{get:function(){return this.windowType},enumerable:!1,configurable:!0}),Object.defineProperty(t,"topMostWindow",{get:function(){return this.getTopWindow()||this.windowType},enumerable:!1,configurable:!0}),Object.defineProperty(t,"document",{get:function(){return this._document||(this._document=this.windowType.document),this._document},enumerable:!1,configurable:!0}),t.isIframe=function(){return this.windowType!==this.getTopWindow()},t.getTopWindow=function(){try{return window.top.document,window.top}catch(t){return null}},t}();e.Context=n},function(t,e,i){"use strict";var n=this&&this.__spreadArray||function(t,e){for(var i=0,n=e.length,o=t.length;i<n;i++,o++)t[o]=e[i];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.Logger=e.LogTypes=void 0;var o=i(0);!function(t){t.INFO="info",t.ERROR="error",t.CUSTOM="custom",t.DEBUG="debug"}(e.LogTypes||(e.LogTypes={}));var r=function(){function t(t){this.className=t,this.isActive=!!o.default.getD().debug}return t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.logMessage("info",t)},t.prototype.verbose=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.logMessage("debug",t)},t.prototype.custom=function(t,e){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];var o=[{msg:t,style:e,args:i}];this.logMessage("custom",o)},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.logMessage("error",t)},t.prototype.logMessage=function(t,e){this.isActive&&("custom"!==t?console[t].apply(console,n(["["+this.className+"]"],e)):console.info("%c["+this.className+"] "+e[0].msg,e[0].style,e[0].args))},t}();e.Logger=r},function(t,e,i){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.Events=void 0;var o=i(0),r=i(2),a=i(4),s=i(1),u=function(){function t(){this.tagData=o.default.getTagData(),this.eventsHost=this.tagData.es,this.logger=new r.Logger("Events"),this.staticData={},this.staticFields={}}return t.get=function(){return t._instance||(this._instance=new t),t._instance},t.prototype.getStaticFields=function(){if(!Object.keys(this.staticFields||{}).length&&this.loaderParams){var t=s.Context.document.location;this.staticFields=Object.assign({},this.buildStaticData(),{url:encodeURIComponent(t.protocol+"//"+t.host+t.pathname),res:s.Context.window.screen.width+"x"+s.Context.window.screen.height})}return this.staticFields},t.prototype.buildStaticData=function(){var t=this.loaderParams.dt||{};return{sk:this.loaderParams.i.sk,pk:this.loaderParams.i.pk,pvid:this.loaderParams.i.pv,bpvid:this.loaderParams.bpvi,aid:this.loaderParams.i.aid,scid:this.loaderParams.i.sc,db:t.b||"",dbt:t.bt||"",d:t.d||"",dp:t.p||"",dos:t.os||"",dosv:t.osv||"",sid:this.loaderParams.i.s,ibpv:this.loaderParams.r.b,geo:this.loaderParams.r.cc,ts:this.loaderParams.r.ts,mv:this.loaderParams.ses.v,iru:this.loaderParams.r.ru}},t.prototype.sendInitialHit=function(t,e,i,r,a){var s=n({uid:t.uid,sk:t.sk,pk:t.pk,sid:t.sid,bpvid:t.bpvid,mv:t.mv,url:encodeURIComponent(t.url)},t.pvid?{pvid:t.pvid}:{}),u=n({now:Math.floor(Date.now()/1e3),et:"initial_hit",to:+new Date-e,res:o.default.getResolution(),ua:i,src:function(t,e){return t?"pb":e?"mt":"bpt"}(this.tagData.fp,this.tagData.mt)+"_"+this.tagData.so,ex:a}),d=n({events:[u]},s);this.send(d,"supply",u.et,s.bpvid)},t.prototype.sendVideoOnLoad=function(t,e){var i=this.getStaticFields(),o={pvid:i.pvid,mv:i.mv,dos:i.dos,sk:i.sk,scid:i.scid,dp:i.dp,geo:i.geo,pk:i.pk},r=n({et:"on_load",il:e,to:+new Date-t}),a=n({events:[r]},o);this.send(a,"supply",r.et,i.pvid)},t.prototype.sendVideoPlayerLoaded=function(t){var e=this.getStaticFields(),i={pvid:e.pvid,bpvid:e.bpvid,url:e.url,sid:e.sid,mv:e.mv,dos:e.dos,db:e.db,sk:e.sk,scid:e.scid,dp:e.dp,geo:e.geo,pk:e.pk},o=n({et:"player_loaded",to:+new Date-t}),r=n({events:[o]},i);this.send(r,"inframe",o.et,e.pvid)},t.prototype.sendLayoutMatchedEvent=function(t){var e=this.getStaticFields(),i={pvid:e.pvid,scid:e.scid,sk:e.sk,pk:e.pk,dp:e.dp,bpvid:e.bpvid,mv:e.mv,url:e.url,geo:e.geo},o=n({now:Math.floor(Date.now()/1e3),et:"layout_matched",to:+new Date-t,vid:!!this.loaderParams.ly.inf}),r=n({events:[o]},i);this.send(r,"supply",o.et,e.pvid)},t.prototype.sendSelectedPubEvent=function(t){var e,i,o,r=this.getStaticFields(),a={pvid:r.pvid,scid:r.scid,sk:r.sk,pk:r.pk,bpvid:r.bpvid,mv:r.mv,url:r.url,geo:r.geo},s=n({et:"selected_pub",to:+new Date-t,spk:null===(e=this.loaderParams.spub)||void 0===e?void 0:e.pk,ssk:null===(i=this.loaderParams.spub)||void 0===i?void 0:i.sk,sscid:null===(o=this.loaderParams.spub)||void 0===o?void 0:o.scid}),u=n({events:[s]},a);this.send(u,"supply",s.et,r.pvid)},t.prototype.send=function(t,e,i,n){var r=new XMLHttpRequest;(r.open("POST",this.eventsHost+"v2/"+e+"?p="+n,!0),r.send(JSON.stringify([t])),this.logger.custom("("+i+", "+e+")","background: #2ecc40; color: #0E3E14; font-weight: bold; text-decoration: underline; font-size: 18px;",t.events[0]?t.events[0]:t),o.default.isD())&&a.Output.getValue("firedEvents",[]).push(t);this.testEvents(t)},t.prototype.testEvents=function(t){if(o.default.isTestMode()){var e=s.Context.window.browsitag;e&&(e.tee=e.tee||[],e.tee.push(t))}},t.prototype.sendError=function(t,e,i,n){var r=s.Context.document.location,a=Object.assign({},{now:Math.floor(Date.now()/1e3),to:+new Date-i,et:"crash",bpvid:e.bpvid,sk:e.sk,pk:e.pk,uid:e.uid,sid:e.sid,file:t.filename,lineNo:t.lineno||-1,columnNo:t.colno||-1,msg:t.message?t.message+"; "+n:n,error:t.error,url:encodeURIComponent(r.protocol+"//"+r.host+r.pathname),res:o.default.getResolution(),pvid:"",ibpv:!1,geo:"",ts:"",db:"",dbt:"",d:"",dp:"",dv:"",dos:"",dosv:"",mv:"",iru:!1,scid:""});if(this.loaderParams&&(a=Object.assign(a,this.getErrorData())),o.default.getD().debug)this.logger.error(a);else{var u=new XMLHttpRequest;u.open("POST",this.tagData.es+"v2/engineError",!0),u.send(JSON.stringify([{events:[a]}])),this.testEvents(a)}},t.prototype.getErrorData=function(){var t=this.loaderParams.dt;return{pvid:this.loaderParams.i.pv,ibpv:this.loaderParams.r.b,geo:this.loaderParams.r.cc,ts:this.loaderParams.r.ts,db:t.b,dbt:t.bt,d:t.d,dp:t.p,dv:t.v,dos:t.os,dosv:t.osv,mv:this.loaderParams.ses.v,iru:this.loaderParams.r.ru,scid:this.loaderParams.i.sc}},t.prototype.setLoaderParams=function(t){this.loaderParams=t},t.prototype.setStaticData=function(t){this.staticData=t},t}();e.Events=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Output=void 0;var n=i(1),o=function(){function t(){}return t.setKeyValues=function(t){this.getBptOut(),Object.assign(n.Context.window[this.bptOutKey],t)},t.getBptOut=function(){return n.Context.window.hasOwnProperty(this.bptOutKey)||(n.Context.window[this.bptOutKey]={}),n.Context.window[this.bptOutKey]},t.getValue=function(t,e){var i=this.getBptOut();return i[t]||(i[t]=e),i[t]},t.bptOutKey="bptOut",t}();e.Output=o},function(t,e,i){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},o=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(o,r){function a(t){try{u(n.next(t))}catch(t){r(t)}}function s(t){try{u(n.throw(t))}catch(t){r(t)}}function u(t){t.done?o(t.value):function(t){return t instanceof i?t:new i(function(e){e(t)})}(t.value).then(a,s)}u((n=n.apply(t,e||[])).next())})},r=this&&this.__generator||function(t,e){var i,n,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(o=2&r[0]?n.return:r[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,n=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],n=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.init=e.setIsNewUserVideoLoaderParam=void 0;var a,s=i(1),u=i(0),d=i(3),l=new(i(2).Logger)("VL-Service");function c(t){var e=-1!==(t.dt.b||"").search(/Internet Explorer/i);return t.ly.inf&&!t.r.b&&!t.ly.am&&!e&&!s.Context.window.browsitag.vl_loaded}function p(t){var e=function(t){for(var e,i,n=t.length;n;)e=[t[i=Math.random()*n-->>>0],t[n]],t[n]=e[0],t[i]=e[1];return t}(t.masterDistribution).find(function(){var t=Math.floor(100*Math.random()+1);return function(e){return(t-=e.weight)<=0}}());if(!e){var i="Failed getting random script group name";throw l.error(i),new Error(i)}return e.groupId}function g(t,e){var i=e.ly.inf.sgn in t.groups?e.ly.inf.sgn:null;if(i)return i;if(e.ly.inf.sgn){var n="Invalid video custom script group name";throw l.error(n),new Error(n)}var o=function(t){var e=u.default.getSessionStorage("avnts_group");if(e in t.groups)return e}(t);if(o)return o;var r=p(t);return u.default.setSessionStorage("avnts_group",r),r}e.setIsNewUserVideoLoaderParam=function(t){a=t},e.init=function(t){var e=t.loaderParams,i=t.staticData,p=t.startTime;return o(this,void 0,void 0,function(){var t,v,f,h,y;return r(this,function(_){switch(_.label){case 0:return _.trys.push([0,2,,3]),c(e)?(s.Context.window.browsitag.vl_loaded=!0,l.info("Injecting video script"),function(t,e){s.Context.window.browsitag.avCallback=function(i){"playerLoaded"===i?d.Events.get().sendVideoPlayerLoaded(e):"impression"===i&&u.default.dispatchDOMEvent("video_ad_impression",{inframeId:t},window)}}(e.ly.inf.id,p),[4,function(){return o(this,void 0,void 0,function(){var t,e,i;return r(this,function(n){switch(n.label){case 0:return[4,u.default.xhrPromise("https://static.avantisvideo.com/data/abc.txt")];case 1:if(t=n.sent(),!(e=200===t.status?t.responseText:null))throw i="Failed retrieving ab-config.txt (video script group config)",l.error(i),new Error(i);return[2,JSON.parse(atob(e.slice(3)))]}})})}()]):(l.info("Avoiding video engine injection"),[2]);case 1:return t=_.sent(),v=g(t,e),f=function(t,e,i){return{pubKey:t.i.pk,siteKey:t.i.sk,pvid:t.i.pv,browser:(t.dt.b||"").toLowerCase(),device:(t.dt.p||"").toLowerCase(),os:t.dt.os||"",osVersion:t.dt.osv||"",sid:t.i.s,country:t.r.cc.toUpperCase(),city:t.r.ct||"",eu:"eu"===t.r.cl,uid:t.i.u,publisherId:t.ly.inf.id,tagId:t.ly.inf.tid,url:e.url+s.Context.document.location.search,referrer:s.Context.document.referrer||"",supplyConfigId:t.i.sc,testGroup:i,newUser:a}}(e,i,v),h=function(t,e){return t+="?id="+e.publisherId+"&tagId="+e.tagId+"&partnerId="+e.supplyConfigId+"&callback=browsitag.avCallback"}(t.groups[v],f),function(t,e,i,o){var r=s.Context.document.createElement("script");r.async=!0,r.id="browsiJS",r.loaderParams=n({},t),r.src=e,r.onerror=function(t){d.Events.get().sendVideoOnLoad(o,!1),d.Events.get().sendError(t,i,o,"onerror "+e)},r.onload=function(){d.Events.get().sendVideoOnLoad(o,!0)};try{u.default.getHead(s.Context.document).appendChild(r)}catch(t){d.Events.get().sendError(t,i,o,"Failed injecting video script")}}(f,h,i,p),function(t,e){s.Context.window.browsitag=Object.assign(s.Context.window.browsitag,{av:{scid:e.i.sc,pvid:e.i.pv,country:e.r.cc,device:e.dt.p,os:e.dt.os,browser:e.dt.b}})}(window,e),[3,3];case 2:return y=_.sent(),d.Events.get().sendError(y,i,p,y.message),[3,3];case 3:return[2]}})})}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TagType=void 0,function(t){t[t.SHADOW=0]="SHADOW",t[t.LEAD=1]="LEAD"}(e.TagType||(e.TagType={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GetSupplyFlowResult=void 0,function(t){t.SUPPLY_REQ_NO_CONTENT="204",t.BOOTSTRAP_LOADED_ERROR="bootstrap already loaded",t.UNEXPECTED_BOOTSTRAP_ON_PAGE="bootstrap already loaded unexpectedly",t.FLOW_ENDED_MANUALLY="flow ended manually"}(e.GetSupplyFlowResult||(e.GetSupplyFlowResult={}))},function(t,e,i){t.exports=i(9)},function(module,exports,__webpack_require__){"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(o,r){function a(t){try{u(n.next(t))}catch(t){r(t)}}function s(t){try{u(n.throw(t))}catch(t){r(t)}}function u(t){t.done?o(t.value):function(t){return t instanceof i?t:new i(function(e){e(t)})}(t.value).then(a,s)}u((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var i,n,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(o=2&r[0]?n.return:r[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,n=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],n=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.mainApp=void 0;var Events_1=__webpack_require__(3),Utils_1=__webpack_require__(0),Logger_1=__webpack_require__(2),Output_1=__webpack_require__(4);__webpack_require__(10);var ConsentManager_1=__webpack_require__(11),Context_1=__webpack_require__(1),EngineDelayService_1=__webpack_require__(12),VideoLoaderService=__webpack_require__(5),ShadowLeadTag_1=__webpack_require__(13),VideoLoaderService_1=__webpack_require__(5),ShadowLeadTag_2=__webpack_require__(6),GetSupplyFlowResult_1=__webpack_require__(7),BIAgentService_1=__webpack_require__(14),AvgHighestBid_1=__webpack_require__(15),insight_agent_blue_green_1=__webpack_require__(16),mainApp=function(){function mainApp(){this.tagData=Utils_1.default.getTagData(),this.initBrowsiTag(),this.startTime=this.getStartTime(),this.logger=new Logger_1.Logger("app"),this.listenToErrors(),this.debugConfiguration=Utils_1.default.getD(),this.staticData=this.buildStaticData(this.debugConfiguration.siteKey),Events_1.Events.get().setStaticData(this.staticData),this.consentManager=new ConsentManager_1.ConsentManager,this.timingData={}}return mainApp.prototype.getStartTime=function(){var t,e;return(null===(t=Context_1.Context.window.browsitag)||void 0===t?void 0:t.st)||(null===(e=this.tagData.pd)||void 0===e?void 0:e.t)||+new Date},mainApp.prototype.run=function(){var t=this;this.isInvalidMultiTagInjection()?Events_1.Events.get().sendInitialHit(this.staticData,this.startTime,this.getUserAgent(),this.findTagPosition(this.tagData.tag),!0):(this.setPubKeyOnPage(),Events_1.Events.get().sendInitialHit(this.staticData,this.startTime,this.getUserAgent(),this.findTagPosition(this.tagData.tag),!1),this.waitForPromise(function(){return t.getSupply()}))},mainApp.prototype.findTagPosition=function(t){for(var e=t,i=Context_1.Context.isIframe();e;)switch(e.tagName){case"HEAD":return i?"iframe.head":"head";case"BODY":return i?"iframe.body":"body";default:e=e.parentElement}return"NA"},mainApp.prototype.getSupply=function(){var t=this;return this.sendGetSupplyRequest().then(function(e){return t.processSupplyResponse(e)}).then(function(e){return t.exposedDataApi(e)}).then(function(e){return t.sendBillableEvent(e)}).then(function(e){return t.processConditionalLayouts(e)}).then(function(e){return t.sendParamsToLiveConfigExtension(e)}).then(function(e){return t.mergeDebugOptions(e)}).then(function(e){return t.sendLayoutMatchedEvent(e)}).then(function(e){return t.handleShadowLeadTag(e)}).then(function(e){return t.runBootstrapDelay(e)}).then(function(e){return t.injectEngines(e)}).catch(function(e){if(e===GetSupplyFlowResult_1.GetSupplyFlowResult.SUPPLY_REQ_NO_CONTENT)return t.logger.info("GetSupply flow result:",e),void t.injectInsightAgent();if(e===GetSupplyFlowResult_1.GetSupplyFlowResult.FLOW_ENDED_MANUALLY)return t.logger.info("GetSupply flow result: ",e),void Context_1.Context.windowType.removeEventListener("error",t.errorListener);throw t.logger.error("Error in get supply",e),new ErrorEvent(e.toString())}).catch(function(e){var i="get supply: "+e.type;Events_1.Events.get().sendError(e,t.staticData,t.startTime,i)})},mainApp.prototype.initBrowsiTag=function(){var t,e,i,n,o,r,a;(t=Context_1.Context.window)[e="browsitag"]||(t[e]={}),(i=Context_1.Context.window.browsitag)["st"]||(i.st=this.getStartTime()),(n=Context_1.Context.window.browsitag)["__ori"]||(n.__ori=Utils_1.default.onReInject),(o=Context_1.Context.window.browsitag)["mt"]||(o.mt={}),(r=Context_1.Context.window.browsitag.mt)["ex"]||(r.ex=[]),(a=Context_1.Context.window.browsitag)["cmd"]||(a.cmd=[])},mainApp.prototype.isConditionalLayoutMatched=function(t){var e;return(null===(e=t.lyd)||void 0===e?void 0:e.lys)&&t.ly},mainApp.prototype.processConditionalLayouts=function(t){var e=this;return new Promise(function(i,n){var o=Utils_1.default.mergeDeep(t.lyd,e.debugConfiguration.lyd||{});e.getSelectedLayout(o,t).then(function(e){return e?(t.ly=e,t.i.sc=e.id,i(t)):n("fail on conditional layout - no layout selected")}).catch(function(t){return n(t)})})},mainApp.prototype.errorIfBootstrapLoaded=function(){if(Utils_1.default.getIsBptLoaded())throw new Error(GetSupplyFlowResult_1.GetSupplyFlowResult.UNEXPECTED_BOOTSTRAP_ON_PAGE)},mainApp.prototype.handleShadowLeadTag=function(t){var e,i,n,o,r;return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(s){switch(s.label){case 0:if(Utils_1.default.getIsBptLoaded())return[2,Promise.reject(GetSupplyFlowResult_1.GetSupplyFlowResult.BOOTSTRAP_LOADED_ERROR)];switch(this.shadowLeadHandler=t.si.sd?new ShadowLeadTag_1.ShadowLead(t.si.sd,t.i.pk):void 0,a=Date.now(),null===(e=this.shadowLeadHandler)||void 0===e?void 0:e.tagType){case ShadowLeadTag_2.TagType.LEAD:return[3,1];case ShadowLeadTag_2.TagType.SHADOW:return[3,3]}return[3,5];case 1:return[4,this.shadowLeadHandler.actAsLeadTag()];case 2:return s.sent(),[3,6];case 3:return[4,this.shadowLeadHandler.actAsShadowTag(t)];case 4:return s.sent(),[3,6];case 5:return[3,6];case 6:return null===(i=this.shadowLeadHandler)||void 0===i||i.recordTimeWaited(Date.now()-a),this.errorIfBootstrapLoaded(),Utils_1.default.setIsBptLoaded(!0),null===(n=this.shadowLeadHandler)||void 0===n||n.mergeSupplyConfigs(t),null===(o=this.shadowLeadHandler)||void 0===o||o.cleanMultiTagAPI(),null===(r=this.shadowLeadHandler)||void 0===r||r.sendSelectedPubEvent(this.startTime),[2,t]}})})},mainApp.prototype.getSelectedLayout=function(layoutsDataObject,loaderParams){return new Promise(function(resolve,reject){if(layoutsDataObject.ly)return resolve(layoutsDataObject.ly);try{var layoutFunction=eval("("+layoutsDataObject.js+")"),layoutFunctionResult=layoutFunction(loaderParams);if(!Utils_1.default.isPromise(layoutFunctionResult))return resolve(layoutsDataObject.lys[layoutFunctionResult]);layoutFunctionResult.then(function(t){return resolve(layoutsDataObject.lys[t])})}catch(t){return reject("fail on conditional layout evaluation "+t)}})},mainApp.prototype.mergeDebugOptions=function(t){var e=this;return new Promise(function(i,n){if(Utils_1.default.mergeDeep(t,e.debugConfiguration),Utils_1.default.isLiveConfigExtensionEnabled()){var o=Utils_1.default.getLiveConfig();Utils_1.default.mergeDeep(t,o)}Events_1.Events.get().setLoaderParams(t),i(t)})},mainApp.prototype.injectBrowsiLogger=function(t){var e=this;if(t.lp){var i=this.buildScriptTag(t.lp);i.id="browsiLogger",i.loaderParams=Object.assign(t,{tagPosition:this.findTagPosition(this.tagData.tag),yieldHost:this.tagData.y}),i.addEventListener("error",function(t){Events_1.Events.get().sendError(t,e.staticData,e.startTime,"script error_browsi logger_"+i.src)}),Utils_1.default.getHead(Context_1.Context.document).appendChild(i)}},mainApp.prototype.sendParamsToLiveConfigExtension=function(t){return new Promise(function(e,i){var n,o;return(n=window).__brw_lc||(n.__brw_lc={}),window.__brw_lc.bpt=!0,(o=window.__brw_lc).que||(o.que=[]),window.__brw_lc.que.push(function(){return Utils_1.default.dispatchDOMEvent("brw_lc_ux",{data:t.sec.ux},Context_1.Context.window)}),e(t)})},mainApp.prototype.sendLayoutMatchedEvent=function(t){var e=this;return new Promise(function(i,n){return e.isConditionalLayoutMatched(t)&&Events_1.Events.get().sendLayoutMatchedEvent(e.startTime),i(t)})},mainApp.prototype.sendBillableEvent=function(t){return new Promise(function(e,i){var n;return"bootstrap_pageview"===(null===(n=t.si)||void 0===n?void 0:n.be)&&Context_1.Context.window.dispatchEvent(new CustomEvent("browsi_pageview",{})),e(t)})},mainApp.prototype.runBootstrapDelay=function(t){var e=this;return new Promise(function(i,n){var o;try{if(!t.ly.bptd)return i(t);var r=t.dt.p,a=t.ly.bptd;new EngineDelayService_1.EngineDelayService({device:r,delayConfig:a},null===(o=e.shadowLeadHandler)||void 0===o?void 0:o.timeWaited).delayEngineByConfig().then(function(){return i(t)})}catch(t){n("delay error "+t.msg||"")}})},mainApp.prototype.exposedDataApi=function(t){var e=this;return new Promise(function(i,n){var o;return!e.tagData.fp&&(null===(o=null===t||void 0===t?void 0:t.is)||void 0===o?void 0:o.eap)&&(Context_1.Context.window.browsitag.data=Context_1.Context.window.browsitag.data||{},Context_1.Context.window.browsitag.data.get=e.getRealTimeData.bind(e,t),window.dispatchEvent(new CustomEvent("browsiData",{detail:{isPartialData:!0}}))),i(t)})},mainApp.prototype.getRealTimeData=function(t,e){var i,n,o;var r=(null===(i=null===t||void 0===t?void 0:t.is)||void 0===i?void 0:i.pg)||{},a=(null===(o=null===(n=null===t||void 0===t?void 0:t.is)||void 0===n?void 0:n.plc)||void 0===o?void 0:o[e])||{},s=Object.entries(a).reduce(function(t,e){var i=e[0],n=function(t){return t?"number"==typeof t?t:"number"==typeof t[0]?t[0]:-1:-1}(e[1]);return n>-1&&(t[i]=n),t},{});return __assign(__assign(__assign({},s),r),{isPartialData:!0})},mainApp.prototype.waitForPromise=function(t){var e=this;if(Context_1.Context.window.Promise)t();else{this.logger.info("fetching Promise polyfill");var i=this.buildScriptTag("//cdn.browsiprod.com/tag/promise.js");i.onload=function(){t()},i.addEventListener("error",function(t){Events_1.Events.get().sendError(t,e.staticData,e.startTime,"script error_polyfill")}),Utils_1.default.getHead(Context_1.Context.document).appendChild(i)}},mainApp.prototype.executeRule=function(t){var e=this;Context_1.Context.window.__browsiLoadFunc=this.getMiddy.bind(this),Context_1.Context.window.__browsiLoadObject=t;var i=this.buildScriptTag(t.js);this.setTiming("rul"),i.addEventListener("load",function(){e.setTiming("rul")}),i.addEventListener("error",function(t){Events_1.Events.get().sendError(t,e.staticData,e.startTime,"script error_rules_"+i.src)}),Utils_1.default.getHead(Context_1.Context.document).appendChild(i)},mainApp.prototype.buildLoader=function(t){var e=t&&t.i&&t.i.s,i=t&&t.i&&t.i.u;t&&(t.i&&(t.i.sk=t.i.sk||this.tagData.sk,t=Object.assign({},t,{bpvi:this.staticData.pvid,yhn:this.tagData.y,rmd:this.extractRTDModuleData(),to:this.startTime})),(t=Object.assign({},t,{h:t.e&&t.e.h,version:t.e&&t.e.v})).td=this.timingData),Utils_1.default.setCookie("__browsiSessionID",e,30,"m"),Utils_1.default.setCookie("__browsiUID",i,365,"d"),Utils_1.default.setLocalStorage("__browsiUID",i);var n={sid:e,uid:i};return Utils_1.default.setLocalStorage("__brtd",JSON.stringify(n)),t},mainApp.prototype.setPubKeyOnPage=function(){var t,e,i=null===(e=null===(t=Context_1.Context.window.browsitag)||void 0===t?void 0:t.mt)||void 0===e?void 0:e.ex,n=this.tagData.pk;null===i||void 0===i||i.push(n)},mainApp.prototype.isInvalidMultiTagInjection=function(){var t,e,i=null===(e=null===(t=Context_1.Context.window.browsitag)||void 0===t?void 0:t.mt)||void 0===e?void 0:e.ex,n=this.tagData.pk;return Utils_1.default.getIsBptLoaded()||(null===i||void 0===i?void 0:i.includes(n))},mainApp.prototype.sendGetSupplyRequest=function(){if("error"===this.staticData.sk)return Promise.reject("no site key");this.handleSpecialUsersSession();var t=this.buildGetSupplyUrl();return Utils_1.default.isD()&&Output_1.Output.setKeyValues({supplyRequest:t}),this.setTiming("s"),this.logger.info("getSupply sent"),Utils_1.default.xhrPromise(t)},mainApp.prototype.handleSpecialUsersSession=function(){var t=this.getUserAgent(),e=Utils_1.default.getLocalStorage("__brw_ua"),i=!e;i||t===e||(this.logger.custom("revoking session","background: orange; color: black; font-weight: bold; font-size: 18px;"),Utils_1.default.setCookie("__browsiSessionID"),this.staticData.sid="",Utils_1.default.setLocalStorage("__brw_ua",t)),i&&Utils_1.default.setLocalStorage("__brw_ua",t)},mainApp.prototype.processSupplyResponse=function(t){var e=this;return new Promise(function(i,n){if(Utils_1.default.isD()&&Output_1.Output.setKeyValues({supplyLoaded:!0}),204===t.status)e.logger.info("Supply response is empty (204)"),n(GetSupplyFlowResult_1.GetSupplyFlowResult.SUPPLY_REQ_NO_CONTENT);else if(200===t.status){var o=JSON.parse(t.responseText);if(o&&!o.error){e.setTiming("s"),Utils_1.default.isD()&&Output_1.Output.setKeyValues({supplyResponse:o});var r=e.buildLoader(o);e.staticData.pvid=r.i.pv,Utils_1.default.setStoredPvid(r.i.pv),i(r)}else n(-1)}else n(t.status)})},mainApp.prototype.buildScriptTag=function(t){var e=this,i=Context_1.Context.document.createElement("script");return i.src=t,i.async=!0,i.onerror=function(i){Events_1.Events.get().sendError(i,e.staticData,e.startTime,"onerror "+t)},i},mainApp.prototype.injectBIAgent=function(t){var e=this;this.logger.info("Injecting BI Agent script");var i=BIAgentService_1.getBIAgentLoaderParams(t);Context_1.Context.window._brw_bia=i;var n=BIAgentService_1.getBIAgentUrl(t),o=this.buildScriptTag(n);o.addEventListener("error",function(t){Events_1.Events.get().sendError(t,e.staticData,e.startTime,"script error_BIAgent script_"+n)});try{Utils_1.default.getHead(Context_1.Context.document).appendChild(o)}catch(t){Events_1.Events.get().sendError(t,this.staticData,this.startTime,"catch; "+n+" bodyExists: "+!!Context_1.Context.document.body)}},mainApp.prototype.getMiddy=function(t,e){var i=this;this.setTiming("mdy"),e&&"function"==typeof e.preEngineJS&&(t.externalFlowHandler={preEngine:e.preEngineJS}),Context_1.Context.window._middyo=t;var n=this.buildMiddyUrl(t),o=this.buildScriptTag(n);o.addEventListener("load",function(){i.setTiming("mdy")}),o.addEventListener("error",function(t){Events_1.Events.get().sendError(t,i.staticData,i.startTime,"script error_middy script_"+n)});try{Utils_1.default.getHead(Context_1.Context.document).appendChild(o)}catch(t){Events_1.Events.get().sendError(t,this.staticData,this.startTime,"catch; "+n+" bodyExists: "+!!Context_1.Context.document.body)}},mainApp.prototype.buildMiddyUrl=function(t){return this.debugConfiguration.middyHost?this.debugConfiguration.middyHost:"//"+(this.debugConfiguration.h||t.si.h)+"/sd/apps/middy/middy-"+(this.debugConfiguration.version||t.ses.v)+".js"},mainApp.prototype.getWeightedAvg=function(t,e,i,n){var o=e+n;return o>0?parseFloat(((t*e+i*n)/o).toFixed(2)):0},mainApp.prototype.getAvgOof=function(){var t=JSON.parse(Utils_1.default.getLocalStorage("__bus")||"{}");if(t.aof){var e=0,i=0,n=t.aof.sd;for(var o in n)n.hasOwnProperty(o)&&(n[o].arb?i++:n[o].ar&&e++);var r=i/(i+e)||0,a=e+i;return this.getWeightedAvg(t.aof.t_a||0,t.aof.t_i||0,r||0,a)}},mainApp.prototype.getQueryParams=function(){var t=[],e=/^(?:\?)(.*)/.exec(Context_1.Context.window.location.search);if(2===(null===e||void 0===e?void 0:e.length)){var i=e[1].split(/&/);t=i.splice(0,Math.min(i.length,10))}return t},mainApp.prototype.buildGetSupplyUrl=function(){return"//"+this.tagData.y+"/supply/v5?"+Utils_1.default.toUrlParams(this.getSupplyParams())},mainApp.prototype.getSupplyParams=function(){var t,e=Context_1.Context.window.screen,i={sk:this.staticData.sk,pk:this.staticData.pk,url:this.staticData.url,bid:this.staticData.bpvid,at:Context_1.Context.document.title||null,sw:(null===e||void 0===e?void 0:e.width)||-1,sh:(null===e||void 0===e?void 0:e.height)||-1},n=this.getQueryParams();n.length&&(i.qp=n.join("&"));var o=JSON.parse(Utils_1.default.getLocalStorage("__bus")||"{}");if(Object.keys(o).length>0){var r={bi:o.bi,bv:o.bv,pi:o.pi,pv:o.pv,b_ativ:o.tiv?this.getWeightedAvg(o.tiv.b_ativ||0,o.tiv.b_ai||0,o.tiv.b_pv_ativ||0,o.tiv.b_pv_ai||0):void 0,uva:o.uv?this.getWeightedAvg(o.uv.t_a||0,o.uv.t_i||0,o.uv.pv_a||0,o.uv.pv_i||0):void 0,uvsp:o.uv?this.getWeightedAvg(o.uv.t_sp||0,o.uv.t_si||0,o.uv.pv_sp||0,o.uv.pv_si||0):void 0,oofu:this.getAvgOof()};Object.keys(r).forEach(function(t){return void 0===r[t]?delete r[t]:""}),i.us=r}if(this.staticData.sid&&(i.sid=this.staticData.sid),Context_1.Context.document.referrer&&(i.r=Context_1.Context.document.referrer),this.staticData.uid&&(i.uid=this.staticData.uid),this.tagData.fp&&(this.logger.info("bootstrap was injected by prebid"),i.rp=!1),!(null===(t=this.tagData.pd)||void 0===t?void 0:t.pvid)){var a=AvgHighestBid_1.getHighestBidMetrics(o)||{},s=a.uahb,u=a.rahb,d=a.lahb,l=a.lbsa;i.ga=__assign(__assign(__assign(__assign({t:Date.now(),eu:Utils_1.default.isEngagingUser()},s?{uahb:s}:{}),u?{rahb:u}:{}),d?{lahb:d}:{}),l?{lbsa:l}:{})}Utils_1.default.isD()&&Output_1.Output.setKeyValues({supplyParams:i});var c=Utils_1.default.getStoredPvid();c&&(i.pvid=c);var p=Utils_1.default.getMetaDataLanguage();return p&&(i.l=p),i},mainApp.prototype.getPageViewId=function(t){var e=t||Utils_1.default.getStoredPvid()||Utils_1.default.generateUUIDIfSupported();return Utils_1.default.setStoredPvid(e),e},mainApp.prototype.buildStaticData=function(t){var e,i,n,o,r=(null===(e=this.tagData.pd)||void 0===e?void 0:e.pvid)&&"undefined"!==(null===(i=this.tagData.pd)||void 0===i?void 0:i.pvid)?null===(n=this.tagData.pd)||void 0===n?void 0:n.pvid:void 0,a=this.getPageViewId(r);(null===(o=this.tagData.pd)||void 0===o?void 0:o.pvid)&&(this.tagData.pd.pvid=void 0);var s=Utils_1.default.getStoredBpvid();s||(s=Utils_1.default.generateToken(),Utils_1.default.setStoredBpvid(s));var u=Context_1.Context.document.location,d=Utils_1.default.getLocalStorage("__browsiUID")||Utils_1.default.getCookie("__browsiUID");return VideoLoaderService_1.setIsNewUserVideoLoaderParam(!d),{to:+new Date-this.startTime,sk:t||this.tagData.sk,pk:this.tagData.pk,pvid:a||"",bpvid:s,url:u.protocol+"//"+u.host+u.pathname,sid:Utils_1.default.getCookie("__browsiSessionID"),uid:d,mv:"3.14.392"}},mainApp.prototype.listenToErrors=function(){var t=this;this.errorListener=function(e){var i=(null===e||void 0===e?void 0:e.target)&&e.target.src&&"SCRIPT"===e.target.tagName?e.target.src:"";(/.*browsiprod.*/.test(e.filename)||/.*browsiprod.*/.test(i))&&Events_1.Events.get().sendError(e,t.staticData,t.startTime,i+","+e.filename)},Context_1.Context.windowType.addEventListener("error",this.errorListener,!0),this.logger.info("listening to errors")},mainApp.prototype.getUserAgent=function(){var t;return(null===(t=Context_1.Context.window.navigator)||void 0===t?void 0:t.userAgent)||""},mainApp.prototype.setTiming=function(t){this.timingData[t]?this.timingData[t]=Number((Date.now()-this.timingData[t]).toFixed(2)):this.timingData[t]=Date.now()},mainApp.prototype.extractRTDModuleData=function(){return this.buildLegacyRTDModuleData()||this.tagData.pd||{}},mainApp.prototype.buildLegacyRTDModuleData=function(){var t,e;if(null===(t=this.tagData.pd)||void 0===t?void 0:t.p){var i=Object.entries(this.tagData.pd.p).reduce(function(t,e){var i=e[0],n=e[1];return t[i]=__assign({},n.ps),t},{});return{kn:(null===(e=this.tagData.pd)||void 0===e?void 0:e.kn)||"",p:i}}},mainApp.prototype.injectVideoLoader=function(t){var e=this.staticData,i=this.startTime;VideoLoaderService.init({loaderParams:t,staticData:e,startTime:i})},mainApp.prototype.injectDisplayEngine=function(t){this.logger.info("Injecting Display script");try{t.js&&"string"==typeof t.js?this.executeRule(t):this.getMiddy(t)}catch(t){this.logger.error(t),Events_1.Events.get().sendError(t,this.staticData,this.startTime,"Display engine injection error")}},mainApp.prototype.injectEngines=function(t){var e;this.injectVideoLoader(t),this.injectBrowsiLogger(t),(null===(e=t.ly.inf)||void 0===e?void 0:e.ad)||this.injectDisplayEngine(t),t.bbi&&this.injectBIAgent(t)},mainApp.prototype.injectInsightAgent=function(){var t=this;if(!this.staticData.url.includes("reuters.com")){var e=Math.random();if(Utils_1.default.getCookie("__binsSID")||e<.5){var i=insight_agent_blue_green_1.getInsightAgentUrl(!0,Context_1.Context.document),n=this.buildScriptTag(i);n.st=this.startTime,n.pvid=this.staticData.pvid,n.sc="bootstrap",n.addEventListener("error",function(e){Events_1.Events.get().sendError(e,t.staticData,t.startTime,"script error_InsightAgent script_"+i)});try{Utils_1.default.getHead(Context_1.Context.document).appendChild(n)}catch(t){Events_1.Events.get().sendError(t,this.staticData,this.startTime,"script error_InsightAgent script_"+i)}}}},mainApp}();exports.mainApp=mainApp,(new mainApp).run()},function(t,e){Array.prototype.filter||(Array.prototype.filter=function(t){"use strict";if(void 0===this||null===this)throw new TypeError;var e=Object(this),i=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var n=[],o=arguments.length>=2?arguments[1]:void 0,r=0;r<i;r++)if(r in e){var a=e[r];t.call(o,a,r,e)&&n.push(a)}return n}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(t){if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),i=e.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var n=arguments[1],o=0;o<i;){var r=e[o];if(t.call(n,r,o,e))return r;o++}}}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){"use strict";if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),n=1;n<arguments.length;n++){var o=arguments[n];if(null!=o)for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(i[r]=o[r])}return i},writable:!0,configurable:!0}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(t,e){if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),n=i.length>>>0;if(0===n)return!1;var o=0|e,r=Math.max(o>=0?o:n-Math.abs(o),0);function a(t,e){return t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e)}for(;r<n;){if(a(i[r],t))return!0;r++}return!1}})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ConsentManager=void 0;var n=i(2),o=i(1),r=i(0),a=function(){function t(){var t=this;this.checkConsentInterval=1e3,this.checkConsentTimeout=1e4,this.gdprTracker={isConsent:!1,interval:-1},this.ccpaTracker={isConsent:!0,interval:-1},this.logger=new n.Logger("ConsentManager");var e={gdpr:function(){return t.getGDPRConsent()},ccpa:function(){return t.getCCPAConsent()}};o.Context.window.browsitag=Object.assign(o.Context.window.browsitag||{},{__cs:e}),this.checkConsentStatus()}return t.prototype.checkConsentStatus=function(){var t=this,e=[["getVendorConsents",null,this.setGDPRConsentCmp.bind(this)]],i=[["getTCData",2,this.setGDPRConsentTcf.bind(this)],["addEventListener",2,this.setGDPRConsentTcf.bind(this)]];this.gdprTracker.interval=setInterval(function(){t.initializeApi("__tcfapi",t.gdprTracker,i),t.initializeApi("__cmp",t.gdprTracker,e)},this.checkConsentInterval),this.initializeApi("__tcfapi",this.gdprTracker,i),this.initializeApi("__cmp",this.gdprTracker,e),setTimeout(function(){clearInterval(t.gdprTracker.interval)},this.checkConsentTimeout),this.checkUsapiConsent()},t.prototype.checkUsapiConsent=function(){var t=[["getUSPData",1,this.setCCPAConsent.bind(this)]];this.initializeApi("__uspapi",this.ccpaTracker,t)},t.prototype.initializeApi=function(t,e,i){var n=o.Context.topMostWindow[t];if(n&&"function"==typeof n)try{clearInterval(e.interval),this.logger.verbose("Found "+t+" function, invoking it..."),i.forEach(function(t){n.apply(void 0,t)})}catch(e){this.logger.error("Error running "+t+" function",e)}else this.logger.verbose("function "+t+" wasn't found")},t.prototype.setGDPRConsentCmp=function(t,e){if(e&&t){if("boolean"==typeof t.gdprApplies&&t.gdprApplies){if(!t.metadata)return;if(t.purposeConsents&&!t.purposeConsents[1])return}this.logger.verbose("User has given consent (GDPR CMP)"),this.setGdprConsentValue(!0)}else this.logger.error("Error in __cmp response")},t.prototype.setGDPRConsentTcf=function(t,e){var i,n=this;if(e&&t){if("boolean"==typeof t.gdprApplies&&t.gdprApplies&&(null===(i=t.purpose)||void 0===i?void 0:i.consents)&&!t.purpose.consents[1])return;this.logger.verbose("User has given consent (GDPR TCF)"),this.setGdprConsentValue(!0),o.Context.topMostWindow.__tcfapi("removeEventListener",2,function(e){e&&n.logger.verbose("remove __tcfapi listener",t.listenerId)},t.listenerId)}else this.logger.error("Error in __tcfapi response")},t.prototype.setCCPAConsent=function(t,e){if(e&&t){var i=t.uspString;return 4===(null===i||void 0===i?void 0:i.length)&&"Y"===i.charAt(2)?(this.logger.verbose("User has opted out consent (CCPA)"),this.setCcpConsentValue(!1)):this.setCcpConsentValue(!0)}this.logger.error("Error in __uspapi response")},t.prototype.getGDPRConsent=function(){var t=this.getLocalStorageConsent().gdpr;return void 0!==t?t:this.gdprTracker.isConsent},t.prototype.getCCPAConsent=function(){this.checkUsapiConsent();var t=this.getLocalStorageConsent().ccpa;return void 0!==t?t:this.ccpaTracker.isConsent},t.prototype.setLocalStorageConsent=function(t){var e=Object.assign(this.getLocalStorageConsent(),t);r.default.setLocalStorage("__broesiUc",JSON.stringify(e))},t.prototype.getLocalStorageConsent=function(){var t=r.default.getLocalStorage("__broesiUc");return t?JSON.parse(t):{}},t.prototype.setCcpConsentValue=function(t){this.ccpaTracker.isConsent=t,this.setLocalStorageConsent({ccpa:t})},t.prototype.setGdprConsentValue=function(t){this.gdprTracker.isConsent=t,this.setLocalStorageConsent({gdpr:t})},t}();e.ConsentManager=a},function(t,e,i){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.EngineDelayService=void 0;var o=i(2),r=function(){function t(t,e){this.readyStateMap={interactive:"DOMContentLoaded",complete:"load"},this.loaderObject=t,this.userEngagementEventsNames=["scroll"],this.userEngagementEventsNames.push("MOBILE"===this.loaderObject.device?"touchstart":"mousedown"),this.logger=new o.Logger("EngineDelay"),this.listenerEvents={},this.delayPromises=[],this.engineDelayTimeoutId=0,this.timeoutToDeduct=e||0}return t.prototype.delayEngineByConfig=function(){var t=this;return this.initDelays(),Promise.race(this.delayPromises).then(function(){t.clearAllDelays()})},t.prototype.initDelays=function(){var t=this.loaderObject.delayConfig,e=t.tod,i=t.rsd,o=t.ued,r=e?Math.max(1e3*e-this.timeoutToDeduct,0)/1e3:void 0,a=n(n(n({},r?{timeoutDelay:r}:{}),i?{readyState:i}:{}),o?{shouldWaitForUserEngagement:o}:{});this.logger.verbose("Engine delay triggers: ",a),r&&this.delayPromises.push(this.setEngineDelayTimeout(r));var s=this.readyStateMap[i]||"";s&&this.delayPromises.push(this.setReadyStateDelay(i,s)),o&&this.delayPromises.push(this.setUserEngagementDelay())},t.prototype.setEngineDelayTimeout=function(t){var e=this;return new Promise(function(i){e.engineDelayTimeoutId=setTimeout(function(){e.logger.verbose("timeout triggered engine"),i()},1e3*t)})},t.prototype.setReadyStateDelay=function(t,e){var i=this;return new Promise(function(n){var o=function(){i.logger.verbose("readyState triggered engine"),n()};if(i.listenerEvents[e]=o,document.readyState===t||"complete"===document.readyState)return o();document.addEventListener(e,o),window.addEventListener(e,o)})},t.prototype.setUserEngagementDelay=function(){var t=this;return new Promise(function(e){var i=function(){t.logger.verbose("User engagement triggered engine"),e()};window.pageYOffset>0?i():t.userEngagementEventsNames.forEach(function(e){t.listenerEvents[e]=i,document.addEventListener(e,i,{once:!0})})})},t.prototype.clearAllDelays=function(){var t=this;clearTimeout(this.engineDelayTimeoutId),Object.keys(this.listenerEvents).forEach(function(e){window.removeEventListener(e,t.listenerEvents[e])})},t}();e.EngineDelayService=r},function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(o,r){function a(t){try{u(n.next(t))}catch(t){r(t)}}function s(t){try{u(n.throw(t))}catch(t){r(t)}}function u(t){t.done?o(t.value):function(t){return t instanceof i?t:new i(function(e){e(t)})}(t.value).then(a,s)}u((n=n.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var i,n,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(o=2&r[0]?n.return:r[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,n=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],n=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},r=this&&this.__spreadArray||function(t,e){for(var i=0,n=e.length,o=t.length;i<n;i++,o++)t[o]=e[i];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.ShadowLead=void 0;var a=i(1),s=i(6),u=i(7),d=i(3),l=i(2),c=function(){function t(t,e){this.multiTagAPI=a.Context.window.browsitag.mt,this.timeoutId=null,this._tagType=t.ty,this.timeoutConfigured=t.t,this.timeWaited=0,this.logger=new l.Logger(this._tagType===s.TagType.LEAD?"Lead tag - "+e:"Shadow tag - "+e)}return Object.defineProperty(t.prototype,"tagType",{get:function(){return this._tagType},enumerable:!1,configurable:!0}),t.prototype.recordTimeWaited=function(t){this.timeWaited||(this.timeWaited=t)},t.prototype.generateTimeoutPromise=function(){var t=this;return new Promise(function(e){t.timeoutId=setTimeout(function(){t.logger.info("Timeout ended! this tag proceeds as Lead tag"),e()},t.timeoutConfigured)})},t.prototype.cleanMultiTagAPI=function(){delete this.multiTagAPI.sr,delete this.multiTagAPI.lr,delete this.multiTagAPI.sd},t.prototype.mergeSupplyConfigs=function(t){var e;if(this.tagType===s.TagType.LEAD&&this.multiTagAPI.sd){var i=this.multiTagAPI.sd;t.spub={scid:i.scid,pk:i.pk,sk:i.sk};var n=null===(e=t.ly.in)||void 0===e?void 0:e.ds,o=i.ds;if((null===n||void 0===n?void 0:n.length)&&(null===o||void 0===o?void 0:o.length)){var a={};r(r([],n),o).forEach(function(t){a[t.w+"x"+t.h]=t}),t.ly.in.ds=Object.values(a)}}},t.prototype.waitForShadowGetSupply=function(){return n(this,void 0,void 0,function(){var t,e,i=this;return o(this,function(n){return this.logger.info("Waiting for shadow tag get supply"),t=new Promise(function(t){i.multiTagAPI.lr=function(){i.logger.info("Shadow tag signaled it got supply"),i.timeoutId&&clearTimeout(i.timeoutId),t()}}),e=this.generateTimeoutPromise(),[2,Promise.race([e,t])]})})},t.prototype.actAsLeadTag=function(){return n(this,void 0,void 0,function(){return o(this,function(t){return this.logger.info("Init lead tag flow"),"function"==typeof this.multiTagAPI.sr&&this.multiTagAPI.sd?(this.multiTagAPI.sr(),this.logger.info("Signaling a shadow tag to end its flow"),[2]):[2,this.waitForShadowGetSupply()]})})},t.prototype.exposeShadowTagConfig=function(t){var e,i,n,o,r;this.logger.info("Expose shadow tag data on page"),this.multiTagAPI.sd={scid:null===(e=t.i)||void 0===e?void 0:e.sc,sk:null===(i=t.i)||void 0===i?void 0:i.sk,pk:null===(n=t.i)||void 0===n?void 0:n.pk,ds:(null===(r=null===(o=t.ly)||void 0===o?void 0:o.in)||void 0===r?void 0:r.ds)||[]}},t.prototype.waitForLeadGetSupply=function(){var t=this;this.logger.info("Waiting for lead tag get supply");var e=new Promise(function(e,i){t.multiTagAPI.sr=function(){t.timeoutId&&clearTimeout(t.timeoutId),i(u.GetSupplyFlowResult.FLOW_ENDED_MANUALLY),t.logger.info("Lead tag signaled it got supply")}}),i=this.generateTimeoutPromise();return Promise.race([i,e])},t.prototype.actAsShadowTag=function(t){return n(this,void 0,void 0,function(){return o(this,function(e){return this.logger.info("Init shadow tag flow"),this.exposeShadowTagConfig(t),this.multiTagAPI.lr&&"function"==typeof this.multiTagAPI.lr?(this.multiTagAPI.lr(),this.logger.info("BPT flow ended manually"),[2,Promise.reject(u.GetSupplyFlowResult.FLOW_ENDED_MANUALLY)]):[2,this.waitForLeadGetSupply()]})})},t.prototype.sendSelectedPubEvent=function(t){d.Events.get().sendSelectedPubEvent(t)},t}();e.ShadowLead=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getBIAgentLoaderParams=e.getBIAgentUrl=void 0;var n=i(0);e.getBIAgentUrl=function(t){var e,i,o=n.default.getBIAgentDebugConfig();return o.agentHost?o.agentHost:"//"+(o.h||(null===(e=t.si)||void 0===e?void 0:e.h))+"/sd/apps/bi-agent/bi-agent-"+(o.version||(null===(i=t.bbi)||void 0===i?void 0:i.v))+".js"},e.getBIAgentLoaderParams=function(t){var e,i,n,o,r,a,s;return{v:null===(e=t.bbi)||void 0===e?void 0:e.v,s:null===(i=t.bbi)||void 0===i?void 0:i.s,b:null===(n=t.bbi)||void 0===n?void 0:n.b,dp:null===(o=t.dt)||void 0===o?void 0:o.p,aid:null===(r=t.i)||void 0===r?void 0:r.aid,es:null===(a=t.r)||void 0===a?void 0:a.es,mc:null===(s=t.sec)||void 0===s?void 0:s.mc}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getLatestAvgHighestBid=e.getRecentAvgBidByTimestamp=e.getRecentAvgHighestBid=e.getHighestBidMetrics=void 0;var n=i(0);function o(t){var e=r(t)||{};if(n.default.isObjectDefined(e)){var i=Object.keys(e).reduce(function(t,i){var n=parseInt(i);return t.sum+=e[n].sum,t.smp+=e[n].smp,t},{sum:0,smp:0});return{avg:i.sum/i.smp,smp:i.smp}}}function r(t){if(n.default.isObjectDefined(t)){var e=n.default.getTimestamp()-7*n.default.millisecondsPerDay;return Object.keys(t).forEach(function(i){var n=parseInt(i);n<e&&delete t[n]}),t}}function a(t){if(n.default.isObjectDefined(t))return{avg:t.avg,smp:t.smp,age:n.default.getDaysDifference(n.default.getTimestamp(),t.time)}}e.getHighestBidMetrics=function(t){var e,i,r,s;if(n.default.isObjectDefined(t)){var u=n.default.isObjectDefined(t.uahb)?t.uahb:void 0,d=a(t.lahb),l=o(t.rahb);return{uahb:(null===u||void 0===u?void 0:u.avg)&&Number(null===(e=null===u||void 0===u?void 0:u.avg)||void 0===e?void 0:e.toFixed(3)),rahb:(null===l||void 0===l?void 0:l.avg)&&Number(null===(i=null===l||void 0===l?void 0:l.avg)||void 0===i?void 0:i.toFixed(3)),lahb:(null===d||void 0===d?void 0:d.avg)&&Number(null===(r=null===d||void 0===d?void 0:d.avg)||void 0===r?void 0:r.toFixed(3)),lbsa:(null===d||void 0===d?void 0:d.age)&&Number(null===(s=null===d||void 0===d?void 0:d.age)||void 0===s?void 0:s.toFixed(3))}}},e.getRecentAvgHighestBid=o,e.getRecentAvgBidByTimestamp=r,e.getLatestAvgHighestBid=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getInsightAgentUrl=void 0;const n=i(17);Object.defineProperty(e,"getInsightAgentUrl",{enumerable:!0,get:function(){return n.getInsightAgentUrl}})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getInsightAgentUrl=void 0;const n=i(18);var o;!function(t){t.P25="25",t.P50="50",t.P100="100"}(o||(o={}));e.getInsightAgentUrl=function(t=!1,e){const i=t?"//cdn.insiad.com/ins-ag/":"https://cdn.insiad.com/ins-ag/";let r=n.getCookie("__insagBGPercentage",e);if(!(r=[o.P25,o.P50,o.P100].includes(r)?r:null)){const t=Math.random();r=t<.25?o.P25:t<.5?o.P50:o.P100}return n.setCookie("__insagBGPercentage",r,e,30,"m"),`${i}ins-ag${r===o.P100?"":`-${r}`}.min.js`}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setCookie=e.getCookie=void 0;e.getCookie=((t,e=window.document)=>{const i=e.cookie.split(/\s*;\s*/).map(t=>{const e=t.split(/\s*=\s*/);if(2===(null===e||void 0===e?void 0:e.length))return{key:e[0],value:e[1]}}).find(e=>(null===e||void 0===e?void 0:e.key)===t);return i?i.value:""});e.setCookie=((t,e="",i=window.document,n=0,o="d")=>{let r=6e4;"d"===o&&(r*=1440);let a=new Date(+new Date+n*r);i.cookie=t+"="+e+"; expires="+a.toUTCString()+"; path=/"})}])}]);