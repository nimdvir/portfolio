!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):((t="undefined"!=typeof globalThis?globalThis:t||self).flowplayer=t.flowplayer||{},t.flowplayer.float_on_scroll=e())}(this,function(){"use strict";const t="resize";const e="float:pop:in",n="float:pop:out",o="float:exit";var l=Object.freeze({__proto__:null,POP_IN:e,POP_OUT:n,EXT_BTN_CLICK:o});const i=(t,e)=>new(((t,e)=>{const n=t.get(e);if(!n)throw new Error(`no flowplayer component with the name ${e} exists`);const o=window.customElements.get(e);if(!o)throw new Error(`no default flowplayer component with the name ${e} exists`);const l=window.customElements.get(n);return"function"!=typeof l?o:l})(t._customElements,e))(t),s=(t,e,n)=>{window.customElements.get(e)||window.customElements.define(e,n),t.customElements.get(e)||t.customElements.set(e,e)},r="flowplayer-mute-icon",a="flowplayer-unmute-icon",c="flowplayer-close-icon";function u(t){return function(t){const e=t.getBoundingClientRect(),n=window.innerHeight,o=e.y;return o>n||o+e.height<0?0:e.y<0?(e.height+o)/e.height:n-e.y>e.height?1:Math.abs((n-e.y)/e.height)}(t)>.8}function f(t,e){0==e.reaper||e.floating||w(e,t,n)}function d(t,n){0!=n.reaper&&n.floating&&w(n,t,e)}function p(t,e,n){const l=document.createElement("div");return l.classList.add("fp-exit-float"),l.append(Object.assign(i(t,c),{role:"button"})),l.addEventListener("click",()=>{if(n.was_user_toggled=!0,!t.opts.float_default)return t.emit(o);t.togglePlay(!1),d(e,t)}),l}function w(n,o,l){l&&n.emit(l),setTimeout(function(){const i=o.querySelector(".fp-float-wrapper"),s=o.clientWidth/o.clientHeight;if(!i)return;i.style.height=l===e?"auto":i.clientWidth/s+"px";const r=i.querySelector(".fp-ad-container > div");r&&(r.style.position=l==e?"absolute":"static"),n.emit(t,{contentRect:{height:l===e?o.clientHeight:i.clientHeight,width:i.clientWidth}})})}const m="is-popped-out";class FlowplayerComponent extends HTMLElement{constructor(t){super(),this.player=t}}class FlowplayerIcon extends FlowplayerComponent{constructor(t,e){super(t),this.classList.add("fp-icon",e.name),e.title&&this.setAttribute("title",e.title),e.title&&this.setAttribute("aria-label",e.title),e.translation_key&&this.setAttribute("aria-label",t.i18n(e.translation_key)),this.setAttribute("tabindex","0"),this.setAttribute("focusable","true")}}const y={translation_key:"core.mute",name:"fp-mute"},h={translation_key:"core.mute",name:"fp-unmute"},g={translation_key:"core.close",name:"fp-close"};var _;const v=((_=class FloatOnScroll{constructor(t){this.flowplayer=t,s(this.flowplayer,r,class extends FlowplayerIcon{constructor(t){super(t,y)}}),s(this.flowplayer,a,class extends FlowplayerIcon{constructor(t){super(t,h)}}),s(this.flowplayer,c,class extends FlowplayerIcon{constructor(t){super(t,g)}})}init(o,l,s){if(!1===o.float_on_scroll)return;if(function(){try{return window.self!==window.top}catch(t){return!0}}())return console.warn("iframe detected - floating player not supported in iframe");void 0===o.float_default&&(o.float_default=!0);const c=this.flowplayer.instances.find(t=>t.root.classList.contains(_.SINGLETON_CLASS));if(c)return o.float_on_scroll=!1,console.warn("disabling float on scroll for player index=%s as it is a singleton behavior\n\tto disable this warning manually configure float_on_scroll: false",this.flowplayer.instances.indexOf(s));l.classList.add(_.SINGLETON_CLASS),o.autopause&&s.setOpts({autopause:!1});const y={pop_out_container:void 0,was_user_toggled:!1};s.popIn=d.bind(this,l,s),s.popOut=f.bind(this,l,s);const h=window.scrollY;s.on("mount",function(){y.pop_out_container=function(t,e){const n=document.createElement("div");return n.classList.add("fp-float-wrapper"),t.appendChild(n),Array.from(t.childNodes).forEach(function(t){t instanceof Element&&(t===n||t.classList.contains("fp-ratio"))||n.appendChild(t)}),e.getFullsceenTarget=()=>n,n}(l,s)}),s.on("renderplugin",function(t){var e;t.preventDefault(),t.detail&&(null===(e=y.pop_out_container)||void 0===e||e.append(t.detail));const n=t.detail.querySelector("flowplayer-ad-controls");n&&n.append(p(s,l,y))});const g=function(t,e){const n=t._customElements.get(e);return n&&t.root.querySelector(n)||void 0}(s,"flowplayer-header");g&&function(t,e,n,o){const l=document.createElement("div");l.classList.add("fp-mute-float"),l.append(...Object.assign([i(o,r),i(o,a)],{role:"button"})),l.addEventListener("click",function(){o.toggleMute()}),t.append(p(o,n,e),l)}(g,y,l,s);const v=function(t,e){const n=t||60,o=Math.ceil(1e3/n);let l=Date.now(),i=-1;return function(...t){return i>-1||Date.now()<l||(i=requestAnimationFrame(function(){i=-1,e(),l=Date.now()+o})),i}}(0,function(){var t;if(u(l)){if(s.hasState("is-fullscreen"))return;null===(t=s.popIn)||void 0===t||t.call(s)}}),b=function(){w(s,l)};s.on("viewleave",t=>{var e;o.float_default&&window.scrollY!==h&&!y.was_user_toggled&&function(t){return!(Array.from(document.querySelectorAll(".fp-engine")).find(t=>t.hasState(m))||t.paused&&(!t.ads||!t.ads.adPlaying))}(s)&&(t.preventDefault(),null===(e=s.popOut)||void 0===e||e.call(s))}),s.on("viewenter",function(){y.was_user_toggled=!1}),s.on(n,function(){s.floating=!0,s.setState(m,!0),o.float_default&&(window.addEventListener("scroll",v),window.addEventListener(t,b))}),s.on(e,function(){s.floating=!1,s.setState(m,!1),o.float_default&&(window.removeEventListener("scroll",v),window.removeEventListener(t,b))})}}).pluginName="float-on-scroll",_.events=l,_.SINGLETON_CLASS="float-on-scroll-enabled",_);return function(t,e){if("object"==typeof exports&&"undefined"!=typeof module)return e;if(null===document.currentScript)return e;"flowplayer"in t||(t.flowplayer={extensions:[]});const n=t.flowplayer;return"function"==typeof n?(n(e),e):(Array.isArray(n.extensions)||(n.extensions=[]),~n.extensions.indexOf(e)||n.extensions.push(e),e)}(window,v)});
