!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e="undefined"!=typeof globalThis?globalThis:e||self).flowplayer=e.flowplayer||{},e.flowplayer.keyboard=t())}(this,function(){"use strict";function e(e,t,n){const o=function(e){return Array.isArray(e)?e.slice(0):e.split(".")}(t);for(;o.length;){if(null==e)return n;const t=o.shift();if("string"!=typeof t)return n;e=e[t]}return null==e?n:e}var t={TAB:"Tab",ENTER:"Enter",ESCAPE:"Escape",SPACE:" ",ARROW_LEFT:"ArrowLeft",ARROW_UP:"ArrowUp",ARROW_RIGHT:"ArrowRight",ARROW_DOWN:"ArrowDown",F:"f",H:"h",J:"j",K:"k",L:"l",M:"m"};const n="mousemove";function o(){Array.from(document.querySelectorAll(".fp-engine")).forEach(e=>{var t;const n=e.root.querySelector("details[open].fp-menu-container");n&&(n.open=!1,null===(t=n.querySelector("summary"))||void 0===t||t.removeAttribute("aria-expanded"),e.root.classList.toggle("has-menu-opened",!1))})}document.addEventListener("click",function(e){this.active_menu&&!e.composedPath().includes(this.active_menu)&&(o(),this.active_menu=void 0)});const r="is-kb-active";let i;function u(e){e.setState(r,!0),clearTimeout(i),i=setTimeout(function(){e.setState(r,!1)},2500)}function s(e,t){e.enqueueSeek(t)&&u(e)}const a="flowplayer-playlist-controls";const c="flowplayer-ad-ui";var l;const f=[t.ARROW_UP,t.ARROW_RIGHT,t.ARROW_LEFT,t.ARROW_DOWN],d=[t.SPACE,t.F,t.ESCAPE,t.M,t.ARROW_UP,t.ARROW_DOWN,t.ARROW_RIGHT,t.ARROW_LEFT,t.H,t.J,t.K,t.L];function R(e,t){e.volume=function(e,t,n=0){return Math.max(Math.min(t,e),n)}(e.volume+t,1,0),u(e)}function p(e){e.preventDefault(),e.stopPropagation()}function m(r){const i=r.key,u=A(),l=document.activeElement;if(!l)return;if(i===t.TAB)return function(){var e,t,o;const r=document.activeElement;if(!r)return;const i=null===(e=r.closest(".flowplayer"))||void 0===e?void 0:e.querySelector(".fp-engine");if(v().forEach(e=>{e.root.hasFocus=i===e,e.setState("is-accessibility",i===e)}),!i)return;if(i.root.dispatchEvent(new Event(n)),!function(e){var t,n;return!(!e.hasState("ad-paused")&&!e.hasState("ad-playing")||!(null===(n=null===(t=null==e?void 0:e.ads)||void 0===t?void 0:t.adapter)||void 0===n?void 0:n.isLinearAd()))}(i)||E(r,c))return;const u=i.root.querySelector(c);if(!u)return;if(i.hasState("ad-playing"))return null===(t=u.querySelector(".fp-small-pause"))||void 0===t?void 0:t.focus();if(i.hasState("ad-paused"))return null===(o=u.querySelector(".fp-small-play"))||void 0===o?void 0:o.focus()}();if((i===t.SPACE||i===t.ENTER)&&l.hasAttribute("tabindex")&&(E(l,".flowplayer")||E(l,a)))return null==l||l.dispatchEvent(new CustomEvent("click",{cancelable:!0,bubbles:!0})),p(r);if((i===t.ARROW_DOWN||i===t.ARROW_UP||i===t.ESCAPE)&&(E(l,".fp-menu-container")||E(l,a))){if(i===t.ARROW_DOWN&&l.nextSibling)return l.nextSibling.focus();if(i===t.ARROW_UP&&l.previousSibling)return l.previousSibling.focus();if(i===t.ESCAPE){const e=new CustomEvent("keyboard:close:menus",{cancelable:!0});if(null==u||u.dispatchEvent(e),e.defaultPrevented)return;return o()}}if(!u)return;let m=e(u,"opts.keyboard.seek_step",5);if(m<1&&(m=Math.round(m*u.duration)),~f.indexOf(i)&&l.hasAttribute("aria-valuenow")){const e=~[t.ARROW_UP,t.ARROW_RIGHT].indexOf(i);if(l.matches(".fp-volume"))return R(u,e?.15:-.15),p(r);if(l.matches(".fp-timeline"))return s(u,e?m:-1*m),p(r)}if(!1===function(e,t){return!(t.altKey||t.shiftKey||t.metaKey||t.ctrlKey)&&!!(e&&e.hasState("is-in-viewport")&&e.started)&&!!e.root&&void 0}(u,r))return;const y=!u.hasState("no-timeline");switch(~d.indexOf(i)&&r.preventDefault(),i){case t.SPACE:return u.togglePlay();case t.F:return u.toggleFullScreen();case t.ESCAPE:return u.hasState("is-fullscreen")?u.toggleFullScreen(!1):void 0;case t.M:return u.toggleMute();case t.ARROW_UP:case t.K:return R(u,.15);case t.ARROW_DOWN:case t.J:return R(u,-.15);case t.ARROW_RIGHT:case t.L:return y&&s(u,m);case t.ARROW_LEFT:case t.H:return y&&s(u,-1*m)}}function y(e){setTimeout(function(){e.defaultPrevented||m(e)},0)}function A(){return v().find(e=>function(e){let t=document.activeElement;for(;t;){if(t===e)return!0;t=t.parentElement}return!1}(e.root))||v().find(e=>document.activeElement===document.body&&e.root.hasFocus)}function v(){return Array.from(document.querySelectorAll(".fp-engine"))}function E(e,t){return!!function(e,t){return e.closest(t)}(e,t)}document.addEventListener("keydown",function(e){if(e.key===t.TAB)return y(e);const n=A();if(n)return function(e,n){const o=document.activeElement;if(e.key===t.F&&n.root.classList.contains("no-fullscreen"))return;if([t.SPACE,t.ARROW_DOWN,t.ARROW_UP,t.ARROW_RIGHT,t.ARROW_LEFT].includes(e.key)||o&&E(o,".fp-menu-container")&&e.key===t.ENTER)return e.preventDefault(),m(e);y(e)}(e,n);const o=document.activeElement;[t.SPACE,t.ENTER,t.ARROW_DOWN,t.ARROW_UP,t.ARROW_RIGHT,t.ARROW_LEFT].includes(e.key)&&o&&E(o,a)&&(e.preventDefault(),m(e))}),document.addEventListener("mousedown",function(e){const t=e.composedPath();v().forEach(e=>{e.setState("is-accessibility",!1),e.root.hasFocus=t.includes(e.root)})});const h=((l=class Keyboard{init(e,t,o){o.once("beforeplay",()=>{o===A()&&o.hasState("is-accessibility")&&o.once("playing",()=>{if(o!==A()||!o.hasState("is-accessibility"))return;const e=o.root.querySelector(".fp-small-pause");e&&(o.root.dispatchEvent(new Event(n)),e.focus())})})}}).pluginName="keyboard",l);return function(e,t){if("object"==typeof exports&&"undefined"!=typeof module)return t;if(null===document.currentScript)return t;"flowplayer"in e||(e.flowplayer={extensions:[]});const n=e.flowplayer;return"function"==typeof n?(n(t),t):(Array.isArray(n.extensions)||(n.extensions=[]),~n.extensions.indexOf(t)||n.extensions.push(t),t)}(window,h)});
