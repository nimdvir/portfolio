!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e="undefined"!=typeof globalThis?globalThis:e||self).flowplayer=e.flowplayer||{},e.flowplayer.share=t())}(this,function(){"use strict";const e="click";const t={name:"fp-facebook"},n={name:"fp-link"},s={name:"fp-share"},i={name:"fp-embed"},o={name:"fp-twitter"};function r(e,t,n){const s=function(e){return Array.isArray(e)?e.slice(0):e.split(".")}(t);for(;s.length;){if(null==e)return n;const t=s.shift();if("string"!=typeof t)return n;e=e[t]}return null==e?n:e}const a="webshare-enabled";function l(){try{return(document.querySelector("meta[name='description']")||{content:""}).content}catch(e){return""}}function c(e){if("string"==typeof e.link)return e.link;const t=document.querySelector("link[rel=canonical]");return t?t.href:window.location.toString()}class FlowplayerComponent extends HTMLElement{constructor(e){super(),this.player=e}}class FlowplayerIcon extends FlowplayerComponent{constructor(e,t){super(e),this.classList.add("fp-icon",t.name),t.title&&this.setAttribute("title",t.title),t.title&&this.setAttribute("aria-label",t.title),t.translation_key&&this.setAttribute("aria-label",e.i18n(t.translation_key)),this.setAttribute("tabindex","0"),this.setAttribute("focusable","true")}}const u=(e,t)=>new(((e,t)=>{const n=e.get(t);if(!n)throw new Error(`no flowplayer component with the name ${t} exists`);const s=window.customElements.get(t);if(!s)throw new Error(`no default flowplayer component with the name ${t} exists`);const i=window.customElements.get(n);return"function"!=typeof i?s:i})(e._customElements,t))(e),d=(e,t,n)=>{window.customElements.get(t)||window.customElements.define(t,n),e.customElements.get(t)||e.customElements.set(t,t)},m="has-menu-opened",h="fp-menu-container",p="fp-on",f="fp-invis",y="details[open]."+h;class FlowplayerMenu extends FlowplayerComponent{constructor(t){super(t),this.player=t,this.menuContainer=document.createElement("details"),this.summaryEle=document.createElement("summary"),this.menuHeader=document.createElement("div"),this.menuTitle=document.createElement("h3"),this.olEle=document.createElement("ol"),this.olEle.id=b(),this.menu=document.createElement("div"),this.closeEle=document.createElement("span"),this.menuHeader.classList.add("fp-menu-header"),this.menuHeader.append(this.menuTitle,this.closeEle),this.menu.classList.add("fp-menu"),this.menu.append(this.menuHeader,this.olEle),this.closeEle.classList.add("fp-close"),this.closeEle.textContent="Ã—",this.menuContainer.classList.add(h),this.menuContainer.append(this.summaryEle,this.menu),this.menuContainer.addEventListener(e,e=>{if(e.defaultPrevented)return;e.preventDefault();const n=this.menuContainer.open;n||(w(),document.active_menu=this.menuContainer),this.menuContainer.open=!n,t.root.classList.toggle(m,!n),this.summaryEle.setAttribute("aria-expanded",n?"false":"true")}),this.addEventListener("focusin",e=>{e.target;HTMLLIElement}),this.addEventListener("focusout",e=>{e.target;HTMLLIElement}),this.append(this.menuContainer),this.olEle.setAttribute("aria-labelledby",this.summaryEle.id),this.olEle.setAttribute("role","menu"),this.summaryEle.setAttribute("aria-haspopup","true"),this.summaryEle.setAttribute("aria-controls",this.olEle.id),this.summaryEle.setAttribute("tabindex","0"),this.summaryEle.setAttribute("aria-expanded","false"),this.summaryEle.setAttribute("role","button")}get options(){return this.olEle.querySelectorAll("li")}setMenuAttrs(e){if(this.className=e.class,this.toggle_visibility(!0),this.summaryEle.id||(this.summaryEle.id=e.id||b()),this.summaryEle.setAttribute("aria-label",e.menuTitle||"Menu"),e.summaryTitle&&(this.summaryEle.textContent=e.summaryTitle),e.summaryIcon){const t=u(this.player,e.summaryIcon);t.setAttribute("tabindex",""),this.summaryEle.append(t)}e.menuTitle&&(this.menuTitle.textContent=e.menuTitle),this.menu.classList.toggle("fp-icons",!!e.icons),this.addEventListener(e.options_event,e=>{this.render(e.data)}),e.item_selected_event&&this.addEventListener(e.item_selected_event,e=>{void 0!==e.data&&this.select_item(e.data.selected_index)})}render(e){this.olEle&&(this.olEle.innerHTML="",e&&e.forEach(this.menuOption,this),this.toggle_visibility(!(null==e?void 0:e.length)))}menuOption(t,n){const s=document.createElement("li");s.setAttribute("tabindex","0"),t.icon&&s.append(t.icon);const i=document.createElement("span");i.textContent=t.text,s.append(i),this.olEle.appendChild(s),t.isButton?(s.setAttribute("role","menuitem"),s.addEventListener(e,()=>{"function"==typeof t.onclick&&t.onclick()})):(s.setAttribute("role","menuitemradio"),s.setAttribute("aria-checked","false"),s.addEventListener(e,()=>{this.select_item(n),"function"==typeof t.onclick&&t.onclick()}),t.selected&&this.select_item(n))}select_item(e){var t;if(!(null===(t=this.options[e])||void 0===t?void 0:t.hasAttribute("aria-checked")))throw new Error("Cannot select a button-only item");this.options.forEach((t,n)=>{t.hasAttribute("aria-checked")&&(t.classList.toggle(p,n===e),t.setAttribute("aria-checked",n===e?"true":"false"))})}unselect_item(){this.options.forEach(e=>{e.classList.remove(p),e.hasAttribute("aria-checked")&&e.setAttribute("aria-checked","false")})}toggle_visibility(e){this.classList.toggle(f,e),this.menu.style.setProperty("display",e?"none":"flex")}}function w(){Array.from(document.querySelectorAll(".fp-engine")).forEach(e=>{var t;const n=e.root.querySelector(y);n&&(n.open=!1,null===(t=n.querySelector("summary"))||void 0===t||t.removeAttribute("aria-expanded"),e.root.classList.toggle(m,!1))})}function b(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}function E(e,t,n){const s=function(e,t){const n=new CustomEvent(e,{detail:t,cancelable:!0});return t&&Object.defineProperty(n,"data",{get:()=>t}),n}(t,n);return e.dispatchEvent(s),e}function g(e,t){const n=e._customElements.get(t);return n&&e.root.querySelector(n)||void 0}document.addEventListener(e,function(e){this.active_menu&&!e.composedPath().includes(this.active_menu)&&(w(),this.active_menu=void 0)}),function(){let e=!1;try{const t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("testPassive",null,t),window.removeEventListener("testPassive",null,t)}catch(e){}}();const v="flowplayer-share-menu",_="flowplayer-share-icon",x="flowplayer-facebook-icon",A="flowplayer-twitter-icon",L="flowplayer-link-icon",k="flowplayer-embed-icon";var C;const S=((C=class Share{constructor(e){this.umd=e,this.share_options=[],d(e,v,class extends FlowplayerMenu{}),d(this.umd,x,class extends FlowplayerIcon{constructor(e){super(e,t)}}),d(this.umd,A,class extends FlowplayerIcon{constructor(e){super(e,o)}}),d(this.umd,L,class extends FlowplayerIcon{constructor(e){super(e,n)}}),d(this.umd,k,class extends FlowplayerIcon{constructor(e){super(e,i)}}),d(this.umd,_,class extends FlowplayerIcon{constructor(e){super(e,s)}})}init(t,n,s){const i=u(s,v);i instanceof FlowplayerMenu&&i.setMenuAttrs({menuTitle:s.i18n("share.menu_title"),class:"fp-share-menu fp-togglable",summaryIcon:_,icons:!0,options_event:C.events.OPTIONS});const o={prev_config:0,webshare_listener:0};s.on("mount",function(){var e;null===(e=g(s,"flowplayer-header-left-zone"))||void 0===e||e.append(i),i instanceof FlowplayerMenu&&i.menuContainer.addEventListener("toggle",function(){n.classList.toggle("is-share-menu",this.open);const e=g(s,"flowplayer-control");this.open&&(n.classList.contains("is-small")?s.pause():e&&function(e,t){if(!t)return;e.menu.style.maxHeight=t.getBoundingClientRect().top+parseFloat(window.getComputedStyle(t).getPropertyValue("padding"))-e.menuContainer.getBoundingClientRect().bottom+"px"}(i,e))})}),s.on("config",n=>{const d=r(n,"data.share",{});if(!1===d)return i instanceof FlowplayerMenu&&void i.classList.remove(a);if(o.prev_config===d)return;if(o.prev_config=d,i instanceof FlowplayerMenu&&function(){try{return"https:"===window.location.protocol&&"function"==typeof navigator.share}catch(e){return!1}}()&&r(d,"web_share",!0))return function(e){e.classList.add(a)}(i),o.webshare_listener||function(t,n,s){s.webshare_listener=!0,n.addEventListener(e,function(){n.classList.contains(a)&&(n.menuContainer.open=!1,navigator.share({title:r(t,"share.title",document.title),text:r(t,"share.text",l()),url:c(r(t,"share",{}))}).catch(function(){}))})}(t,i,o);this.share_options=[];const m="string"==typeof d.link?d.link:window.location.toString();if(d.iframe){const e="string"==typeof d.iframe?d.iframe:m;this.share_options.push(I(s,i,"share.embed",M.bind(null,e,s),u(s,k)))}d.link&&this.share_options.push(I(s,i,"share.link",O.bind(null,m),u(s,L))),d.facebook&&this.share_options.push(I(s,i,"Facebook",H.bind(null,m),u(s,x))),d.twitter&&this.share_options.push(I(s,i,"Twitter",P.bind(null,m),u(s,A))),E(i,C.events.OPTIONS,this.share_options)})}add_options(e,...t){const n=e.root.querySelector(v);n&&t.forEach(t=>{const s=I(e,n,t.text,t.onclick,t.icon);n.menuOption(s,n.options.length)})}}).pluginName="share",C.events={OPTIONS:"share:options"},C);function I(e,t,n,s,i){return{text:T(e,n),icon:i,onclick:F.bind(null,e,t,s),isButton:!0}}function T(e,t){return 0===t.indexOf("share.")?e.i18n(t):t}function F(e,t,n){t instanceof FlowplayerMenu&&t.unselect_item();const s=n();s.success&&s.message&&e.message&&e.emit(e.message.events.SHOW_MESSAGE,{message:s.message})}function M(e,t){const n=t.videoHeight/t.videoWidth;return O('<div style="position:relative;width:100%;display:inline-block;"><iframe src="__IFRAME_SRC__" allowfullscreen style="border:none;position:absolute;top:0;left:0;width:100%;height:100%;"></iframe><div style="padding-top: __RATIO__%;"></div></div>'.replace("__IFRAME_SRC__",encodeURI(e)).replace("__RATIO__",""+100*n))}function O(e){const t=document.createElement("textarea");t.setAttribute("style","position:absolute;opacity:0"),t.value=e;const n=document.body;n.append(t),t.select();const s=document.execCommand("copy");return n.removeChild(t),{success:s,message:s?"<trans share.clipboard_success trans>":"<trans share.clipboard_failure trans>"}}function H(e){return R("https://www.facebook.com/sharer.php?u="+encodeURIComponent(e)),{success:!0}}function P(e){return R("https://twitter.com/intent/tweet?url="+encodeURIComponent(e)),{success:!0}}function R(e){let t;const n=screen.height,s=screen.width,i=Math.round(s/2-275);t=0,n>420&&(t=Math.round(n/2-210)),window.open(e,"sharer","scrollbars=yes,resizable=yes,toolbar=no,location=yes,width=550,height=420,left="+i+",top="+t)}return function(e,t){if("object"==typeof exports&&"undefined"!=typeof module)return t;if(null===document.currentScript)return t;"flowplayer"in e||(e.flowplayer={extensions:[]});const n=e.flowplayer;return"function"==typeof n?(n(t),t):(Array.isArray(n.extensions)||(n.extensions=[]),~n.extensions.indexOf(t)||n.extensions.push(t),t)}(window,S)});
