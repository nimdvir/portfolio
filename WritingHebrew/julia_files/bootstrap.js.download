!function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){t.exports=n(1)},function(module,exports){!function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=6)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return Object.defineProperty(t,"windowType",{get:function(){return this._window||(this._window=window.top),this._window},enumerable:!0,configurable:!0}),Object.defineProperty(t,"window",{get:function(){return this.windowType},enumerable:!0,configurable:!0}),Object.defineProperty(t,"topMostWindow",{get:function(){return this.getTopWindow()||this.windowType},enumerable:!0,configurable:!0}),Object.defineProperty(t,"document",{get:function(){return this._document||(this._document=this.windowType.document),this._document},enumerable:!0,configurable:!0}),t.hasTopAccess=function(){return null!==this.getTopWindow()},t.isIframe=function(){return this.windowType!==this.getTopWindow()},t.getTopWindow=function(){try{return window.top.document,window.top}catch(t){return null}},t}();e.Context=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=function(){function t(){}return t.getTagData=function(){var t;try{t=document.currentScript,t.getAttribute("data-siteKey")&&t.getAttribute("data-pubKey")||(t=document.getElementById("browsi-tag"))}catch(e){t=document.getElementById("browsi-tag")}if(!t)throw new Error("no tag");var e=this.getSessionStorage("__browsienv")||t.getAttribute("data-browsidomain")||".browsiprod.com",n="";try{var i=t.getAttribute("src")||"";n=new URL(i).host}catch(t){n="NA"}return{tag:t,sk:t.getAttribute("data-siteKey")||"error",pk:t.getAttribute("data-pubKey")||"error",ds:e,y:"yield-manager"+e,es:"//events"+e+"/events/",fp:t.hasAttribute("prebidbpt"),mt:t.hasAttribute("master"),pd:t.prebidData,so:n}},t.getSessionStorage=function(t){var e;try{e=sessionStorage.getItem(t)}catch(t){}return e||""},t.setSessionStorage=function(t,e){sessionStorage[t]="string"==typeof e?e:JSON.stringify(e)},t.getD=function(){var t=this.getSessionStorage("__brwsidbg"),e={};return t&&(e=JSON.parse(t)),e},t.isD=function(){var e=t.getD();return!(!e||!e.hasOwnProperty("debug"))},t.isObject=function(t){return t&&"object"==typeof t&&!Array.isArray(t)},t.mergeDeep=function(t,e){if(this.isObject(t)&&this.isObject(e))for(var n in e)e.hasOwnProperty(n)&&this.isObject(e[n])?(t[n]||Object.assign(t,(i={},i[n]={},i)),this.mergeDeep(t[n],e[n])):Object.assign(t,(r={},r[n]=e[n],r));return t;var i,r},t.generateToken=function(){var t="abcdefghijklmnopqrstuvwxyz";t+=t.toUpperCase()+"_!@#$";for(var e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},t.getCookie=function(t){var e=i.Context.document.cookie.split(/\s*;\s*/).map(function(t){var e=t.split(/\s*=\s*/);if(e&&2===e.length)return{key:e[0],value:e[1]}}).find(function(e){return e&&e.key===t});return e?e.value:""},t.setCookie=function(t,e,n,r){void 0===e&&(e=""),void 0===n&&(n=0),void 0===r&&(r="d");var o=6e4;"d"===r&&(o*=1440);var s=new Date(+new Date+n*o);i.Context.document.cookie=t+"="+e+"; expires="+s.toUTCString()+"; path=/"},t.setLocalStorage=function(t,e){try{localStorage.setItem(t,e)}catch(t){}},t.getLocalStorage=function(t){try{return i.Context.windowType.localStorage.getItem(t)||""}catch(t){}return""},t.toUrlParams=function(t){return Object.keys(t).map(function(e){return e+"="+("object"==typeof t[e]?encodeURIComponent(JSON.stringify(t[e])):encodeURIComponent(t[e]))}).join("&")},t.getHead=function(t){return t.head||t.getElementsByTagName("head")[0]},t.getResolution=function(){return i.Context.windowType.screen.width+"x"+i.Context.windowType.screen.height},t.isPositionContained=function(t,e){return!!(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)},t.isVisible=function(t){return this.isCssVisible(t)&&this.hasValidSize(t)},t.isCssVisible=function(t){var e=i.Context.windowType.getComputedStyle(t);return!!e&&("visible"===e.getPropertyValue("visibility")&&"none"!==e.getPropertyValue("display")&&"0"!==e.getPropertyValue("opacity"))},t.hasValidSize=function(t){var e=t.getBoundingClientRect();return e.height>0&&e.width>0},t.getUrlParams=function(){var t=i.Context.document.location.search.substring(1);if(0===t.length)return{};var e={};return t.split("&").forEach(function(t){var n=t.split("=");2===n.length&&n[0]&&(e[n[0]]=n[1])}),e},t.xhrPromise=function(t){return new Promise(function(e,n){var i=new XMLHttpRequest;i.open("GET",t,!0),i.onreadystatechange=function(){i.readyState==(i.DONE||4)&&(200===i.status||204===i.status?e(i):n(i.status))},i.send()})},t.isPromise=function(t){return t instanceof Promise},t.dispatchDOMEvent=function(t,e,n){var i=new CustomEvent(t,{detail:e});n.dispatchEvent(i)},t.generateUUID=function(){return window.crypto&&window.crypto.randomUUID?window.crypto.randomUUID():""},t.getUUIDIfSupported=function(){var e=t.generateUUID();return e?(t.setStoredPvid(e),e):""},t.getStoredPvid=function(){try{return i.Context.window.__brpvid}catch(t){return}},t.setStoredPvid=function(t){try{i.Context.window.__brpvid=t}catch(t){}},t}();e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1);!function(t){t.INFO="info",t.ERROR="error",t.CUSTOM="custom",t.DEBUG="debug"}(e.LogTypes||(e.LogTypes={}));var r=function(){function t(t){this.className=t,this.isActive=!!i.default.getD().debug}return t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.logMessage("info",t)},t.prototype.verbose=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.logMessage("debug",t)},t.prototype.custom=function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var r=[{msg:t,style:e,args:n}];this.logMessage("custom",r)},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.logMessage("error",t)},t.prototype.logMessage=function(t,e){this.isActive&&("custom"!==t?console[t].apply(console,["["+this.className+"]"].concat(e)):console.info("%c["+this.className+"] "+e[0].msg,e[0].style,e[0].args))},t}();e.Logger=r},function(t,e,n){"use strict";var i=this&&this.__assign||Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t};Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),o=n(2),s=n(4),a=n(0),u=function(){function t(){this.tagData=r.default.getTagData(),this.eventsHost=this.tagData.es,this.logger=new o.Logger("Events")}return t.get=function(){return t._instance||(this._instance=new t),t._instance},t.prototype.getStaticFields=function(){if(!this.staticFields&&this.loaderParams){var t=a.Context.document.location;this.staticFields=Object.assign({},this.buildStaticData(),{url:encodeURIComponent(t.protocol+"//"+t.host+t.pathname),res:a.Context.window.screen.width+"x"+a.Context.window.screen.height})}return this.staticFields},t.prototype.buildStaticData=function(){var t=this.loaderParams.dt||{};return{sk:this.loaderParams.i.sk,pk:this.loaderParams.i.pk,pvid:this.loaderParams.i.pv,bpvid:this.loaderParams.bpvi,aid:this.loaderParams.i.aid,scid:this.loaderParams.i.sc,db:t.b||"",dbt:t.bt||"",d:t.d||"",dp:t.p||"",dv:t.v||"",dos:t.os||"",dosv:t.osv||"",sid:this.loaderParams.i.s,ibpv:this.loaderParams.r.b,geo:this.loaderParams.r.cc,ts:this.loaderParams.r.ts,mv:this.loaderParams.ses.v,iru:this.loaderParams.r.ru}},t.prototype.sendInitialHit=function(t,e,n,o,s){var u=i({uid:t.uid,sk:t.sk,pk:t.pk,sid:t.sid,bpvid:t.bpvid,mv:t.mv,url:encodeURIComponent(t.url)},t.pvid?{pvid:t.pvid}:{}),c=i({},i({now:Math.floor(Date.now()/1e3),et:"initial_hit",to:+new Date-e,res:r.default.getResolution(),ua:n,tp:o,ta:a.Context.hasTopAccess(),src:function(t,e){return t?"pb":e?"mt":"bpt"}(this.tagData.fp,this.tagData.mt)+"_"+this.tagData.so,ex:s},"d_mapping"===t.sk?{l:a.Context.window.location.hostname}:{})),d=i({events:[c]},u);this.send(d,"supply",c.et,u.bpvid)},t.prototype.sendVideoOnLoad=function(t,e){var n=this.getStaticFields(),r={pvid:n.pvid,bpvid:n.bpvid,url:n.url,sid:n.sid,mv:n.mv,dos:n.dos,sk:n.sk,scid:n.scid,dp:n.dp,geo:n.geo,pk:n.pk},o=i({et:"on_load",il:e,to:+new Date-t}),s=i({events:[o]},r);this.send(s,"inframe",o.et,n.pvid)},t.prototype.sendVideoPlayerLoaded=function(t){var e=this.getStaticFields(),n={pvid:e.pvid,bpvid:e.bpvid,url:e.url,sid:e.sid,mv:e.mv,dos:e.dos,db:e.db,sk:e.sk,scid:e.scid,dp:e.dp,geo:e.geo,pk:e.pk},r=i({et:"player_loaded",to:+new Date-t}),o=i({events:[r]},n);this.send(o,"inframe",r.et,e.pvid)},t.prototype.sendLayoutMatchedEvent=function(t){var e=this.getStaticFields(),n={pvid:e.pvid,scid:e.scid,sk:e.sk,pk:e.pk,dp:e.dp,bpvid:e.bpvid,mv:e.mv,url:e.url,geo:e.geo},r=i({now:Math.floor(Date.now()/1e3),et:"layout_matched",to:+new Date-t}),o=i({events:[r]},n);this.send(o,"supply",r.et,e.pvid)},t.prototype.send=function(t,e,n,i){var o=new XMLHttpRequest;if(o.open("POST",this.eventsHost+"v2/"+e+"?p="+i,!0),o.send(JSON.stringify([t])),this.logger.custom("("+n+", "+e+")","background: #2ecc40; color: #0E3E14; font-weight: bold; text-decoration: underline; font-size: 18px;",t.events[0]?t.events[0]:t),r.default.isD()){s.Output.getValue("firedEvents",[]).push(t)}},t.prototype.sendError=function(t,e,n,i){var o=a.Context.document.location,s=Object.assign({},{now:Math.floor(Date.now()/1e3),to:+new Date-n,et:"crash",bpvid:e.bpvid,sk:e.sk,pk:e.pk,uid:e.uid,sid:e.sid,file:t.filename,lineNo:t.lineno||-1,columnNo:t.colno||-1,msg:t.message?t.message+"; "+i:i,error:t.error,url:encodeURIComponent(o.protocol+"//"+o.host+o.pathname),res:r.default.getResolution(),pvid:"",ibpv:!1,geo:"",ts:"",db:"",dbt:"",d:"",dp:"",dv:"",dos:"",dosv:"",mv:"",iru:!1,scid:""});if(this.loaderParams&&(s=Object.assign(s,this.getErrorData())),r.default.getD().debug)this.logger.error(s);else{var u=new XMLHttpRequest;u.open("POST",this.tagData.es+"v2/engineError",!0),u.send(JSON.stringify([s]))}},t.prototype.getErrorData=function(){var t=this.loaderParams.dt;return{pvid:this.loaderParams.i.pv,ibpv:this.loaderParams.r.b,geo:this.loaderParams.r.cc,ts:this.loaderParams.r.ts,db:t.b,dbt:t.bt,d:t.d,dp:t.p,dv:t.v,dos:t.os,dosv:t.osv,mv:this.loaderParams.ses.v,iru:this.loaderParams.r.ru,scid:this.loaderParams.i.sc}},t.prototype.setLoaderParams=function(t){this.loaderParams=t},t.prototype.setStaticData=function(t){this.staticData=t},t}();e.Events=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=function(){function t(){}return t.setKeyValues=function(t){this.getBptOut(),Object.assign(i.Context.window[this.bptOutKey],t)},t.getBptOut=function(){return i.Context.window.hasOwnProperty(this.bptOutKey)||(i.Context.window[this.bptOutKey]={}),i.Context.window[this.bptOutKey]},t.getValue=function(t,e){var n=this.getBptOut();return n[t]||(n[t]=e),n[t]},t.bptOutKey="bptOut",t}();e.Output=r},function(t,e,n){"use strict";function i(t){b=t}function r(t){for(var e,n=t.length;n;)e=Math.random()*n-->>>0,i=[t[e],t[n]],t[n]=i[0],t[e]=i[1];return t;var i}function o(t){var e=-1!==(t.dt.b||"").search(/Internet Explorer/i);return t.ly.inf&&!t.r.b&&!t.ly.am&&!e}function s(){return y(this,void 0,void 0,function(){var t,e,n;return m(this,function(i){switch(i.label){case 0:return[4,w.default.xhrPromise("https://static.avantisvideo.com/data/abc.txt")];case 1:if(t=i.sent(),!(e=200===t.status?t.responseText:null))throw n="Failed retrieving ab-config.txt (video script group config)",E.error(n),new Error(n);return[2,JSON.parse(atob(e.slice(3)))]}})})}function a(t){var e=r(t.masterDistribution),n=e.find(function(){var t=Math.floor(100*Math.random()+1);return function(e){return(t-=e.weight)<=0}}());if(!n){var i="Failed getting random script group name";throw E.error(i),new Error(i)}return n.groupId}function u(t){var e=w.default.getSessionStorage("avnts_group");if(e in t.groups)return e}function c(t,e){var n=e.ly.inf.sgn in t.groups?e.ly.inf.sgn:null;if(n)return n;if(e.ly.inf.sgn){var i="Invalid video custom script group name";throw E.error(i),new Error(i)}var r=u(t);if(r)return r;var o=a(t);return w.default.setSessionStorage("avnts_group",o),o}function d(t,e){return t+="?id="+e.publisherId+"&tagId="+e.tagId+"&partnerId="+e.supplyConfigId+"&callback=browsitag.avCallback"}function p(t,e,n){return{pubKey:t.i.pk,siteKey:t.i.sk,pvid:t.i.pv,browser:(t.dt.b||"").toLowerCase(),device:(t.dt.p||"").toLowerCase(),os:t.dt.os||"",osVersion:t.dt.osv||"",sid:t.i.s,country:t.r.cc.toUpperCase(),city:t.r.ct||"",eu:"eu"===t.r.cl,uid:t.i.u,publisherId:t.ly.inf.id,tagId:t.ly.inf.tid,url:e.url+_.Context.document.location.search,referrer:_.Context.document.referrer||"",supplyConfigId:t.i.sc,testGroup:n,newUser:b}}function l(t){var e=t.loaderParams,n=t.staticData,i=t.startTime;return y(this,void 0,void 0,function(){var t,r,a,u,l;return m(this,function(v){switch(v.label){case 0:return v.trys.push([0,2,,3]),o(e)?(E.info("Injecting video script"),f(e.ly.inf.id,i),[4,s()]):(E.info("Avoiding video engine injection"),[2]);case 1:return t=v.sent(),r=c(t,e),a=p(e,n,r),u=d(t.groups[r],a),h(a,u,n,i),g(window,e),[3,3];case 2:return l=v.sent(),C.Events.get().sendError(l,n,i,l.message),[3,3];case 3:return[2]}})})}function g(t,e){_.Context.window.browsitag=Object.assign(_.Context.window.browsitag,{av:{scid:e.i.sc,pvid:e.i.pv,country:e.r.cc,device:e.dt.p,os:e.dt.os,browser:e.dt.b}})}function f(t,e){_.Context.window.browsitag.avCallback=function(n){"playerLoaded"===n?C.Events.get().sendVideoPlayerLoaded(e):"impression"===n&&w.default.dispatchDOMEvent("video_ad_impression",{inframeId:t},window)}}function h(t,e,n,i){var r=_.Context.document.createElement("script");r.async=!0,r.id="browsiJS",r.loaderParams=v({},t),r.src=e,r.onerror=function(t){C.Events.get().sendVideoOnLoad(i,!1),C.Events.get().sendError(t,n,i,"onerror "+e)},r.onload=function(){C.Events.get().sendVideoOnLoad(i,!0)};try{w.default.getHead(_.Context.document).appendChild(r)}catch(t){C.Events.get().sendError(t,n,i,"Failed injecting video script")}}var v=this&&this.__assign||Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},y=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,o){function s(t){try{u(i.next(t))}catch(t){o(t)}}function a(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,a)}u((i=i.apply(t,e||[])).next())})},m=this&&this.__generator||function(t,e){function n(t){return function(e){return i([t,e])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,o&&(s=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(s=u.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){u.label=n[1];break}if(6===n[0]&&u.label<s[1]){u.label=s[1],s=n;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(n);break}s[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,s,a,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(e,"__esModule",{value:!0});var b,_=n(0),w=n(1),C=n(3),D=n(2),E=new D.Logger("VL-Service");e.setIsNewUserVideoLoaderParam=i,e.init=l},function(t,e,n){t.exports=n(7)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Events_1=__webpack_require__(3),Utils_1=__webpack_require__(1),Logger_1=__webpack_require__(2),Output_1=__webpack_require__(4);__webpack_require__(8);var ConsentManager_1=__webpack_require__(9),Context_1=__webpack_require__(0),EngineDelayService_1=__webpack_require__(10),VideoLoaderService=__webpack_require__(5),VideoLoaderService_1=__webpack_require__(5),mainApp=function(){function mainApp(){this.startTime=+new Date,this.tagData=Utils_1.default.getTagData(),this.logger=new Logger_1.Logger("app"),this.listenToErrors(),this.debugConfiguration=Utils_1.default.getD(),this.staticData=this.buildStaticData(this.debugConfiguration.siteKey),Events_1.Events.get().setStaticData(this.staticData),this.consentManager=new ConsentManager_1.ConsentManager,this.timingData={}}return mainApp.prototype.run=function(){var t=this;this.isBootstrapLoaded()?Events_1.Events.get().sendInitialHit(this.staticData,this.startTime,this.getUserAgent(),this.findTagPosition(this.tagData.tag),!0):(this.setBootstrapLoaded(),this.staticData.pvid=Utils_1.default.getUUIDIfSupported(),Events_1.Events.get().sendInitialHit(this.staticData,this.startTime,this.getUserAgent(),this.findTagPosition(this.tagData.tag),!1),this.waitForPromise(function(){return t.getSupply()}))},mainApp.prototype.findTagPosition=function(t){for(var e=t,n=Context_1.Context.isIframe();e;)switch(e.tagName){case"HEAD":return n?"iframe.head":"head";case"BODY":return n?"iframe.body":"body";default:e=e.parentElement}return"NA"},mainApp.prototype.setBootstrapLoaded=function(){Context_1.Context.window.browsi_bootstrap_loaded=this.staticData.bpvid},mainApp.prototype.getSupply=function(){var t=this;return this.sendGetSupplyRequest().then(function(e){return t.processSupplyResponse(e)}).then(function(e){return t.sendBillableEvent(e)}).then(function(e){return t.processConditionalLayouts(e)}).then(function(e){return t.mergeDebugOptions(e)}).then(function(e){return t.sendLayoutMatchedEvent(e)}).then(function(e){return t.runBootstrapDelay(e)}).then(function(e){var n=t,i=n.staticData,r=n.startTime;if(VideoLoaderService.init({loaderParams:e,staticData:i,startTime:r}),e.ly.inf&&e.ly.inf.ad)return void t.logger.info("Avoiding display engine injection");t.createBrowsiTag(),t.injectBrowsiLogger(e),t.logger.info("Injecting Display script"),e.js&&"string"==typeof e.js?t.executeRule(e):t.getMiddy(e)}).catch(function(e){if(204!==e)throw t.logger.error("Error in get supply",e),new ErrorEvent(e.toString())}).catch(function(e){var n="get supply: "+e.type;Events_1.Events.get().sendError(e,t.staticData,t.startTime,n)})},mainApp.prototype.createBrowsiTag=function(){Context_1.Context.window.browsitag=Context_1.Context.window.browsitag||{}},mainApp.prototype.isConditionalLayoutMatched=function(t){return t.lyd&&t.lyd.lys&&t.ly},mainApp.prototype.processConditionalLayouts=function(t){var e=this;return new Promise(function(n,i){var r=Utils_1.default.mergeDeep(t.lyd,e.debugConfiguration.lyd||{});e.getSelectedLayout(r,t).then(function(e){return e?(t.ly=e,t.i.sc=e.id,n(t)):i("fail on conditional layout - no layout selected")}).catch(function(t){return i(t)})})},mainApp.prototype.getSelectedLayout=function(layoutsDataObject,loaderParams){return new Promise(function(resolve,reject){if(layoutsDataObject.ly)return resolve(layoutsDataObject.ly);try{var layoutFunction=eval("("+layoutsDataObject.js+")"),layoutFunctionResult=layoutFunction(loaderParams);if(!Utils_1.default.isPromise(layoutFunctionResult))return resolve(layoutsDataObject.lys[layoutFunctionResult]);layoutFunctionResult.then(function(t){return resolve(layoutsDataObject.lys[t])})}catch(t){return reject("fail on conditional layout evaluation "+t)}})},mainApp.prototype.mergeDebugOptions=function(t){var e=this;return new Promise(function(n,i){Utils_1.default.mergeDeep(t,e.debugConfiguration),Events_1.Events.get().setLoaderParams(t),n(t)})},mainApp.prototype.injectBrowsiLogger=function(t){var e=this;if(t.lp){var n=this.buildScriptTag(t.lp);n.id="browsiLogger",n.loaderParams=Object.assign(t,{tagPosition:this.findTagPosition(this.tagData.tag),yieldHost:this.tagData.y}),n.addEventListener("error",function(t){Events_1.Events.get().sendError(t,e.staticData,e.startTime,"script error_browsi logger_"+n.src)}),Utils_1.default.getHead(Context_1.Context.document).appendChild(n)}},mainApp.prototype.sendLayoutMatchedEvent=function(t){var e=this;return new Promise(function(n,i){return e.isConditionalLayoutMatched(t)&&Events_1.Events.get().sendLayoutMatchedEvent(e.startTime),n(t)})},mainApp.prototype.sendBillableEvent=function(t){return new Promise(function(e,n){return t.si&&"bootstrap_pageview"===t.si.be&&Context_1.Context.window.dispatchEvent(new CustomEvent("browsi_pageview",{})),e(t)})},mainApp.prototype.runBootstrapDelay=function(t){return new Promise(function(e,n){try{if(!t.ly.bptd)return e(t);var i=t.dt.p,r=t.ly.bptd;new EngineDelayService_1.EngineDelayService({device:i,delayConfig:r}).delayEngineByConfig().then(function(){return e(t)})}catch(t){n("delay error "+t.msg||"")}})},mainApp.prototype.waitForPromise=function(t){var e=this;if(Context_1.Context.window.Promise)t();else{this.logger.info("fetching Promise polyfill");var n=this.buildScriptTag("//cdn.browsiprod.com/tag/promise.js");n.onload=function(){t()},n.addEventListener("error",function(t){Events_1.Events.get().sendError(t,e.staticData,e.startTime,"script error_polyfill")}),Utils_1.default.getHead(Context_1.Context.document).appendChild(n)}},mainApp.prototype.executeRule=function(t){var e=this;Context_1.Context.window.__browsiLoadFunc=this.getMiddy.bind(this),Context_1.Context.window.__browsiLoadObject=t;var n=this.buildScriptTag(t.js);this.setTiming("rul"),n.addEventListener("load",function(){e.setTiming("rul")}),n.addEventListener("error",function(t){Events_1.Events.get().sendError(t,e.staticData,e.startTime,"script error_rules_"+n.src)}),Utils_1.default.getHead(Context_1.Context.document).appendChild(n)},mainApp.prototype.buildLoader=function(t){var e=t&&t.i&&t.i.s,n=t&&t.i&&t.i.u;t&&(t.i&&(t.i.sk=t.i.sk||this.tagData.sk,t=Object.assign({},t,{bpvi:this.staticData.pvid,yhn:this.tagData.y,to:this.startTime})),t=Object.assign({},t,{h:t.e&&t.e.h,version:t.e&&t.e.v}),t.td=this.timingData),Utils_1.default.setCookie("__browsiSessionID",e,30,"m"),Utils_1.default.setCookie("__browsiUID",n,365,"d"),Utils_1.default.setLocalStorage("__browsiUID",n);var i={sid:e,uid:n};return Utils_1.default.setLocalStorage("__brtd",JSON.stringify(i)),t},mainApp.prototype.isBootstrapLoaded=function(){return!!Context_1.Context.window.browsi_bootstrap_loaded},mainApp.prototype.getPreviousBpvid=function(){return Context_1.Context.window.browsi_bootstrap_loaded},mainApp.prototype.sendGetSupplyRequest=function(){if("error"===this.staticData.sk)return Promise.reject("no site key");this.handleSpecialUsersSession();var t=this.buildGetSupplyUrl();return Utils_1.default.isD()&&Output_1.Output.setKeyValues({supplyRequest:t}),this.setTiming("s"),this.logger.info("getSupply sent"),Utils_1.default.xhrPromise(t)},mainApp.prototype.handleSpecialUsersSession=function(){var t=this.getUserAgent(),e=Utils_1.default.getLocalStorage("__brw_ua"),n=!e;n||t===e||(this.logger.custom("revoking session","background: orange; color: black; font-weight: bold; font-size: 18px;"),Utils_1.default.setCookie("__browsiSessionID"),this.staticData.sid="",Utils_1.default.setLocalStorage("__brw_ua",t)),n&&Utils_1.default.setLocalStorage("__brw_ua",t)},mainApp.prototype.processSupplyResponse=function(t){var e=this;return new Promise(function(n,i){if(Utils_1.default.isD()&&Output_1.Output.setKeyValues({supplyLoaded:!0}),204===t.status)e.logger.info("Supply response is empty (204)"),i(t.status);else if(200===t.status){var r=JSON.parse(t.responseText);if(r&&!r.error){e.setTiming("s"),Utils_1.default.isD()&&Output_1.Output.setKeyValues({supplyResponse:r});var o=e.buildLoader(r);e.staticData.pvid=o.i.pv,Utils_1.default.setStoredPvid(o.i.pv),n(o)}else i(-1)}else i(t.status)})},mainApp.prototype.buildScriptTag=function(t){var e=this,n=Context_1.Context.document.createElement("script");return n.src=t,n.async=!0,n.setAttribute("crossorigin","anonymous"),n.onerror=function(n){Events_1.Events.get().sendError(n,e.staticData,e.startTime,"onerror "+t)},n},mainApp.prototype.getMiddy=function(t,e){var n=this;this.setTiming("mdy"),e&&"function"==typeof e.preEngineJS&&(t.externalFlowHandler={preEngine:e.preEngineJS}),Context_1.Context.window._middyo=t;var i=this.buildMiddyUrl(t),r=this.buildScriptTag(i);r.addEventListener("load",function(){n.setTiming("mdy")}),r.addEventListener("error",function(t){Events_1.Events.get().sendError(t,n.staticData,n.startTime,"script error_middy script_"+i)});try{Utils_1.default.getHead(Context_1.Context.document).appendChild(r)}catch(t){Events_1.Events.get().sendError(t,this.staticData,this.startTime,"catch; "+i+" bodyExists: "+!!Context_1.Context.document.body)}},mainApp.prototype.buildMiddyUrl=function(t){return this.debugConfiguration.middyHost?this.debugConfiguration.middyHost:"//"+(this.debugConfiguration.h||t.si.h)+"/sd/apps/middy/middy-"+(this.debugConfiguration.version||t.ses.v)+".js"},mainApp.prototype.getWeightedAvg=function(t,e,n,i){var r=e+i;return r>0?parseFloat(((t*e+n*i)/r).toFixed(2)):0},mainApp.prototype.getAvgOof=function(){var t=JSON.parse(Utils_1.default.getLocalStorage("__bus")||"{}");if(t.aof){var e=0,n=0,i=t.aof.sd;for(var r in i)i.hasOwnProperty(r)&&(i[r].arb?n++:i[r].ar&&e++);var o=n/(n+e)||0,s=e+n;return this.getWeightedAvg(t.aof.t_a||0,t.aof.t_i||0,o||0,s)}},mainApp.prototype.getQueryParams=function(){var t=[],e=/^(?:\?)(.*)/.exec(Context_1.Context.window.location.search);if(e&&2===e.length){var n=e[1].split(/&/);t=n.splice(0,Math.min(n.length,10))}return t},mainApp.prototype.buildGetSupplyUrl=function(){return"//"+this.tagData.y+"/supply/v5?"+Utils_1.default.toUrlParams(this.getSupplyParams())},mainApp.prototype.getSupplyParams=function(){var t=Context_1.Context.window.screen,e={sk:this.staticData.sk,pk:this.staticData.pk,url:this.staticData.url,bid:this.staticData.bpvid,at:Context_1.Context.document.title||null,sw:t&&t.width||-1,sh:t&&t.height||-1},n=this.getQueryParams();n.length&&(e.qp=n.join("&"));var i=JSON.parse(Utils_1.default.getLocalStorage("__bus")||"{}");if(Object.keys(i).length>0){var r={bi:i.bi,bv:i.bv,pi:i.pi,pv:i.pv,b_ativ:i.tiv?this.getWeightedAvg(i.tiv.b_ativ||0,i.tiv.b_ai||0,i.tiv.b_pv_ativ||0,i.tiv.b_pv_ai||0):void 0,uva:i.uv?this.getWeightedAvg(i.uv.t_a||0,i.uv.t_i||0,i.uv.pv_a||0,i.uv.pv_i||0):void 0,uvsp:i.uv?this.getWeightedAvg(i.uv.t_sp||0,i.uv.t_si||0,i.uv.pv_sp||0,i.uv.pv_si||0):void 0,oofu:this.getAvgOof()};Object.keys(r).forEach(function(t){return void 0===r[t]?delete r[t]:""}),e.us=r}this.staticData.sid&&(e.sid=this.staticData.sid),Context_1.Context.document.referrer&&(e.r=Context_1.Context.document.referrer),this.staticData.uid&&(e.uid=this.staticData.uid),this.tagData.fp&&(this.logger.info("bootstrap was injected by prebid"),e.rp=!1),Utils_1.default.isD()&&Output_1.Output.setKeyValues({supplyParams:e});var o=Utils_1.default.getStoredPvid();return o&&(e.pvid=o),e},mainApp.prototype.buildStaticData=function(t){var e=this.isBootstrapLoaded()?this.getPreviousBpvid():Utils_1.default.generateToken(),n=Context_1.Context.document.location,i=Utils_1.default.getLocalStorage("__browsiUID")||Utils_1.default.getCookie("__browsiUID");return VideoLoaderService_1.setIsNewUserVideoLoaderParam(!i),{to:+new Date-this.startTime,sk:t||this.tagData.sk,pk:this.tagData.pk,pvid:Utils_1.default.getStoredPvid()||"",bpvid:e,url:n.protocol+"//"+n.host+n.pathname,sid:Utils_1.default.getCookie("__browsiSessionID"),uid:i,mv:"2.33.13"}},mainApp.prototype.listenToErrors=function(){var t=this;Context_1.Context.windowType.addEventListener("error",function(e){var n=e&&e.srcElement&&e.srcElement.src&&"SCRIPT"===e.srcElement.tagName?e.srcElement.src:"";(/.*browsiprod.*/.test(e.filename)||/.*browsiprod.*/.test(n))&&Events_1.Events.get().sendError(e,t.staticData,t.startTime,n+","+e.filename)},!0),this.logger.info("listening to errors")},mainApp.prototype.getUserAgent=function(){var t=Context_1.Context.window.navigator;return t&&t.userAgent?t.userAgent:""},mainApp.prototype.setTiming=function(t){this.timingData[t]?this.timingData[t]=Number((Date.now()-this.timingData[t]).toFixed(2)):this.timingData[t]=Date.now()},mainApp}();exports.mainApp=mainApp,(new mainApp).run()},function(t,e){Array.prototype.filter||(Array.prototype.filter=function(t){"use strict";if(void 0===this||null===this)throw new TypeError;var e=Object(this),n=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var i=[],r=arguments.length>=2?arguments[1]:void 0,o=0;o<n;o++)if(o in e){var s=e[o];t.call(r,s,o,e)&&i.push(s)}return i}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(t){if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),n=e.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var i=arguments[1],r=0;r<n;){var o=e[r];if(t.call(i,o,r,e))return o;r++}}}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){"use strict";if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])}return n},writable:!0,configurable:!0}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(t,e){if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),i=n.length>>>0;if(0===i)return!1;for(var r=0|e,o=Math.max(r>=0?r:i-Math.abs(r),0);o<i;){if(function(t,e){return t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e)}(n[o],t))return!0;o++}return!1}})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(0),o=n(1),s=function(){function t(){var t=this;this.checkConsentInterval=1e3,this.checkConsentTimeout=1e4,this.gdprTracker={isConsent:!1,interval:-1},this.ccpaTracker={isConsent:!0,interval:-1},this.logger=new i.Logger("ConsentManager");var e={gdpr:function(){return t.getGDPRConsent()},ccpa:function(){return t.getCCPAConsent()}};r.Context.window.browsitag=Object.assign(r.Context.window.browsitag||{},{__cs:e}),this.checkConsentStatus()}return t.prototype.checkConsentStatus=function(){var t=this,e=[["getVendorConsents",null,this.setGDPRConsentCmp.bind(this)]],n=[["getTCData",2,this.setGDPRConsentTcf.bind(this)],["addEventListener",2,this.setGDPRConsentTcf.bind(this)]];this.gdprTracker.interval=setInterval(function(){t.initializeApi("__tcfapi",t.gdprTracker,n),t.initializeApi("__cmp",t.gdprTracker,e)},this.checkConsentInterval),this.initializeApi("__tcfapi",this.gdprTracker,n),this.initializeApi("__cmp",this.gdprTracker,e),setTimeout(function(){clearInterval(t.gdprTracker.interval)},this.checkConsentTimeout),this.checkUsapiConsent()},t.prototype.checkUsapiConsent=function(){var t=[["getUSPData",1,this.setCCPAConsent.bind(this)]];this.initializeApi("__uspapi",this.ccpaTracker,t)},t.prototype.initializeApi=function(t,e,n){var i=r.Context.topMostWindow[t];if(!i||"function"!=typeof i)return void this.logger.verbose("function "+t+" wasn't found");try{clearInterval(e.interval),this.logger.verbose("Found "+t+" function, invoking it..."),n.forEach(function(t){i.apply(void 0,t)})}catch(e){this.logger.error("Error running "+t+" function",e)}},t.prototype.setGDPRConsentCmp=function(t,e){if(e&&t){if("boolean"==typeof t.gdprApplies&&t.gdprApplies){if(!t.metadata)return;if(t.purposeConsents&&!t.purposeConsents[1])return}this.logger.verbose("User has given consent (GDPR CMP)"),this.setGdprConsentValue(!0)}else this.logger.error("Error in __cmp response")},t.prototype.setGDPRConsentTcf=function(t,e){var n=this;if(e&&t){if("boolean"==typeof t.gdprApplies&&t.gdprApplies&&t.purpose&&t.purpose.consents&&!t.purpose.consents[1])return;this.logger.verbose("User has given consent (GDPR TCF)"),this.setGdprConsentValue(!0),r.Context.topMostWindow.__tcfapi("removeEventListener",2,function(e){e&&n.logger.verbose("remove __tcfapi listener",t.listenerId)},t.listenerId)}else this.logger.error("Error in __tcfapi response")},t.prototype.setCCPAConsent=function(t,e){if(e&&t){var n=t.uspString;return n&&4===n.length&&"Y"===n.charAt(2)?(this.logger.verbose("User has opted out consent (CCPA)"),this.setCcpConsentValue(!1)):this.setCcpConsentValue(!0)}this.logger.error("Error in __uspapi response")},t.prototype.getGDPRConsent=function(){var t=this.getLocalStorageConsent().gdpr;return void 0!==t?t:this.gdprTracker.isConsent},t.prototype.getCCPAConsent=function(){this.checkUsapiConsent();var t=this.getLocalStorageConsent().ccpa;return void 0!==t?t:this.ccpaTracker.isConsent},t.prototype.setLocalStorageConsent=function(t){var e=Object.assign(this.getLocalStorageConsent(),t);o.default.setLocalStorage("__broesiUc",JSON.stringify(e))},t.prototype.getLocalStorageConsent=function(){var t=o.default.getLocalStorage("__broesiUc");return t?JSON.parse(t):{}},t.prototype.setCcpConsentValue=function(t){this.ccpaTracker.isConsent=t,this.setLocalStorageConsent({ccpa:t})},t.prototype.setGdprConsentValue=function(t){this.gdprTracker.isConsent=t,this.setLocalStorageConsent({gdpr:t})},t}();e.ConsentManager=s},function(t,e,n){"use strict";var i=this&&this.__assign||Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t};Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),o=function(){function t(t){this.readyStateMap={interactive:"DOMContentLoaded",complete:"load"},this.loaderObject=t,this.userEngagementEventsNames=["scroll"],this.userEngagementEventsNames.push("MOBILE"===this.loaderObject.device?"touchstart":"mousedown"),this.logger=new r.Logger("EngineDelay"),this.listenerEvents={},this.delayPromises=[]}return t.prototype.delayEngineByConfig=function(){var t=this;return this.initDelays(),Promise.race(this.delayPromises).then(function(){t.clearAllDelays()})},t.prototype.initDelays=function(){var t=this.loaderObject.delayConfig,e=t.tod,n=t.rsd,r=t.ued,o=i({},e?{timeoutDelay:e}:{},n?{readyState:n}:{},r?{shouldWaitForUserEngagement:r}:{});this.logger.verbose("Engine delay triggers: ",o),e&&this.delayPromises.push(this.setEngineDelayTimeout(e));var s=this.readyStateMap[n]||"";s&&this.delayPromises.push(this.setReadyStateDelay(n,s)),r&&this.delayPromises.push(this.setUserEngagementDelay())},t.prototype.setEngineDelayTimeout=function(t){var e=this;return new Promise(function(n){e.engineDelayTimeoutId=setTimeout(function(){e.logger.verbose("timeout triggered engine"),n()},1e3*t)})},t.prototype.setReadyStateDelay=function(t,e){var n=this;return new Promise(function(i){var r=function(){n.logger.verbose("readyState triggered engine"),i()};if(n.listenerEvents[e]=r,document.readyState===t||"complete"===document.readyState)return r();document.addEventListener(e,r),window.addEventListener(e,r)})},t.prototype.setUserEngagementDelay=function(){var t=this;return new Promise(function(e){var n=function(){t.logger.verbose("User engagement triggered engine"),e()};if(window.pageYOffset>0)return void n();t.userEngagementEventsNames.forEach(function(e){t.listenerEvents[e]=n,document.addEventListener(e,n,{once:!0})})})},t.prototype.clearAllDelays=function(){var t=this;clearTimeout(this.engineDelayTimeoutId),Object.keys(this.listenerEvents).forEach(function(e){window.removeEventListener(e,t.listenerEvents[e])})},t}();e.EngineDelayService=o}])}]);